<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RayVita-Synapse | Advanced Neural Health Analytics Platform</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-cyan: #00ffff;
            --primary-blue: #0080ff;
            --primary-purple: #8000ff;
            --accent-pink: #ff0080;
            --accent-green: #00ff88;
            --accent-orange: #ff8800;
            --accent-gold: #ffd700;
            --dark-bg: #0a0a0f;
            --card-bg: rgba(255, 255, 255, 0.03);
            --glass-bg: rgba(255, 255, 255, 0.05);
            --border-glow: rgba(0, 255, 255, 0.3);
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --text-muted: #808080;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: radial-gradient(ellipse at top, #1a1a2e 0%, #16213e 25%, #0f1419 50%, var(--dark-bg) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Enhanced Background Effects */
        .neural-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -3;
        }

        .neural-nodes {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image:
                radial-gradient(3px 3px at 20px 30px, var(--primary-cyan), transparent),
                radial-gradient(2px 2px at 40px 70px, var(--primary-blue), transparent),
                radial-gradient(2px 2px at 90px 40px, var(--accent-pink), transparent),
                radial-gradient(1px 1px at 130px 80px, var(--primary-purple), transparent),
                radial-gradient(2px 2px at 160px 30px, var(--accent-green), transparent);
            background-size: 200px 200px, 150px 150px, 180px 180px, 120px 120px, 140px 140px;
            animation: neuralFloat 20s linear infinite;
            opacity: 0.4;
        }

        @keyframes neuralFloat {
            0% { transform: translate(0, 0) rotate(0deg); }
            100% { transform: translate(-200px, -200px) rotate(360deg); }
        }

        .grid-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                linear-gradient(rgba(0, 255, 255, 0.08) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 255, 0.08) 1px, transparent 1px);
            background-size: 60px 60px;
            z-index: -2;
            animation: gridPulse 8s ease-in-out infinite;
        }

        @keyframes gridPulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.7; }
        }

        .constellation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.2;
        }

        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: var(--primary-cyan);
            border-radius: 50%;
            animation: twinkle 3s ease-in-out infinite alternate;
        }

        @keyframes twinkle {
            0% { opacity: 0.3; transform: scale(1); }
            100% { opacity: 1; transform: scale(1.5); }
        }

        /* App Container */
        .app-container {
            position: relative;
            min-height: 100vh;
        }

        /* Enhanced Login Screen */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(20px);
            background: rgba(0, 0, 0, 0.8);
        }

        .login-container {
            background: var(--glass-bg);
            border: 2px solid var(--border-glow);
            border-radius: 24px;
            padding: 50px;
            backdrop-filter: blur(30px);
            box-shadow: 0 25px 60px rgba(0, 255, 255, 0.15);
            width: 100%;
            max-width: 480px;
            position: relative;
            overflow: hidden;
        }

        .login-container::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: linear-gradient(45deg, var(--primary-cyan), var(--primary-blue), var(--primary-purple), var(--accent-pink));
            border-radius: 24px;
            z-index: -1;
            animation: borderGlow 4s ease-in-out infinite;
        }

        @keyframes borderGlow {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        .logo-section {
            text-align: center;
            margin-bottom: 40px;
        }

        .logo-icon {
            width: 100px;
            height: 100px;
            background: linear-gradient(45deg, var(--primary-cyan), var(--primary-blue));
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 25px;
            font-family: 'Orbitron', monospace;
            font-size: 48px;
            font-weight: 900;
            color: #000;
            animation: logoSpin 12s linear infinite;
            box-shadow: 0 15px 40px rgba(0, 255, 255, 0.4);
        }

        .app-title {
            font-family: 'Orbitron', monospace;
            font-size: 32px;
            font-weight: 900;
            letter-spacing: 3px;
            background: linear-gradient(45deg, var(--primary-cyan), var(--primary-blue));
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
        }

        .app-subtitle {
            color: var(--text-secondary);
            font-size: 16px;
            letter-spacing: 1px;
            line-height: 1.4;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            margin-bottom: 10px;
            color: var(--primary-cyan);
            font-size: 14px;
            font-weight: 600;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .form-input, .form-textarea {
            width: 100%;
            padding: 18px 24px;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 15px;
            color: var(--text-primary);
            font-size: 16px;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary-cyan);
            box-shadow: 0 0 25px rgba(0, 255, 255, 0.4);
            background: rgba(0, 255, 255, 0.05);
            transform: translateY(-2px);
        }

        .auth-button, .action-button {
            width: 100%;
            padding: 18px;
            background: linear-gradient(45deg, var(--primary-cyan), var(--primary-blue));
            border: none;
            border-radius: 15px;
            color: #000;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .auth-button:hover, .action-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(0, 255, 255, 0.5);
        }

        .auth-toggle {
            text-align: center;
            color: var(--text-secondary);
            font-size: 14px;
            margin-top: 20px;
        }

        .auth-toggle a {
            color: var(--primary-cyan);
            text-decoration: none;
            cursor: pointer;
            font-weight: 600;
        }

        /* Enhanced Main App Layout */
        .main-app {
            display: none;
        }

        .app-header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(25px);
            border-bottom: 2px solid var(--border-glow);
            padding: 20px 40px;
            box-shadow: 0 8px 32px rgba(0, 255, 255, 0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1800px;
            margin: 0 auto;
        }

        .header-logo {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, var(--primary-cyan), var(--primary-blue));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Orbitron', monospace;
            font-weight: 900;
            color: #000;
            font-size: 24px;
            animation: logoSpin 15s linear infinite;
            box-shadow: 0 8px 25px rgba(0, 255, 255, 0.3);
        }

        .header-title {
            font-family: 'Orbitron', monospace;
            font-size: 28px;
            font-weight: 700;
            color: var(--primary-cyan);
            letter-spacing: 2px;
        }

        .header-nav {
            display: flex;
            gap: 8px;
            background: rgba(0, 0, 0, 0.3);
            padding: 6px;
            border-radius: 15px;
            border: 1px solid rgba(0, 255, 255, 0.2);
            flex-wrap: wrap;
        }

        .nav-item {
            padding: 10px 18px;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s ease;
            font-weight: 500;
            border: 1px solid transparent;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        .nav-item:hover {
            background: var(--glass-bg);
            border-color: var(--border-glow);
            transform: translateY(-2px);
        }

        .nav-item.active {
            background: linear-gradient(45deg, var(--primary-cyan), var(--primary-blue));
            color: #000;
            font-weight: 700;
            box-shadow: 0 5px 15px rgba(0, 255, 255, 0.3);
        }

        .header-user {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            background: linear-gradient(45deg, var(--accent-pink), var(--primary-purple));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: #fff;
            font-size: 18px;
            box-shadow: 0 5px 15px rgba(255, 0, 128, 0.3);
        }

        .logout-btn {
            padding: 10px 20px;
            background: rgba(255, 0, 128, 0.2);
            border: 1px solid var(--accent-pink);
            border-radius: 10px;
            color: var(--accent-pink);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 12px;
            letter-spacing: 1px;
        }

        .logout-btn:hover {
            background: var(--accent-pink);
            color: #000;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 0, 128, 0.4);
        }

        /* Enhanced Content Area */
        .content-area {
            padding: 40px;
            max-width: 1800px;
            margin: 0 auto;
        }

        /* Panel Styles */
        .panel {
            display: none;
            animation: panelSlide 0.5s ease-out;
        }

        .panel.active {
            display: block;
        }

        @keyframes panelSlide {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .panel-header {
            margin-bottom: 40px;
            text-align: center;
        }

        .panel-title {
            font-family: 'Orbitron', monospace;
            font-size: 42px;
            font-weight: 700;
            background: linear-gradient(45deg, var(--primary-cyan), var(--primary-blue), var(--primary-purple));
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
            letter-spacing: 2px;
        }

        .panel-subtitle {
            color: var(--text-secondary);
            font-size: 18px;
            line-height: 1.6;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Enhanced Card Grid */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .card-grid.dense {
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        .card-grid.wide {
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
        }

        /* Enhanced Neural Card */
        .neural-card {
            background: var(--card-bg);
            border: 1px solid var(--border-glow);
            border-radius: 25px;
            padding: 35px;
            backdrop-filter: blur(25px);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.05);
        }

        .neural-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--primary-cyan), transparent);
            animation: cardScan 5s linear infinite;
        }

        @keyframes cardScan {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .neural-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 25px 60px rgba(0, 255, 255, 0.2);
            border-color: var(--primary-cyan);
        }

        .neural-card.featured {
            border: 2px solid var(--accent-gold);
            box-shadow: 0 15px 40px rgba(255, 215, 0, 0.1);
        }

        .neural-card.featured::before {
            background: linear-gradient(90deg, transparent, var(--accent-gold), transparent);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .card-title {
            font-family: 'Orbitron', monospace;
            font-size: 20px;
            font-weight: 600;
            color: var(--primary-cyan);
            letter-spacing: 1px;
        }

        .card-subtitle {
            color: var(--text-secondary);
            font-size: 14px;
            margin-top: 5px;
        }

        .card-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, var(--accent-pink), var(--primary-purple));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            animation: iconFloat 4s ease-in-out infinite;
        }

        @keyframes iconFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }

        /* Enhanced Metrics */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 20px;
        }

        .metric-item {
            text-align: center;
            padding: 25px;
            background: rgba(0, 255, 255, 0.05);
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 15px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .metric-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(0, 255, 255, 0.1), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s ease;
        }

        .metric-item:hover::before {
            transform: translateX(100%);
        }

        .metric-item:hover {
            background: rgba(0, 255, 255, 0.1);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 255, 255, 0.2);
        }

        .metric-value {
            font-family: 'Orbitron', monospace;
            font-size: 28px;
            font-weight: 700;
            color: var(--primary-cyan);
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
        }

        .metric-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .metric-trend {
            margin-top: 8px;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .trend-up { color: var(--accent-green); }
        .trend-down { color: var(--accent-pink); }
        .trend-stable { color: var(--accent-orange); }

        /* Enhanced Chart Container */
        .chart-container {
            position: relative;
            height: 320px;
            margin-top: 25px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            border: 1px solid rgba(0, 255, 255, 0.1);
        }

        .chart-container.large {
            height: 450px;
        }

        .chart-container.xlarge {
            height: 500px;
        }

        /* AI Chat Interface */
        .ai-chat-container {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            height: 600px;
        }

        .chat-interface {
            display: flex;
            flex-direction: column;
            background: var(--card-bg);
            border: 1px solid var(--border-glow);
            border-radius: 20px;
            overflow: hidden;
        }

        .chat-header {
            background: linear-gradient(45deg, var(--primary-purple), var(--accent-pink));
            color: #fff;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            max-width: 80%;
            padding: 15px 20px;
            border-radius: 18px;
            position: relative;
            animation: messageSlide 0.3s ease-out;
        }

        @keyframes messageSlide {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            background: linear-gradient(45deg, var(--primary-cyan), var(--primary-blue));
            color: #000;
            align-self: flex-end;
            margin-left: auto;
        }

        .message.ai {
            background: var(--glass-bg);
            border: 1px solid rgba(128, 0, 255, 0.3);
            color: var(--text-primary);
            align-self: flex-start;
        }

        .chat-input-area {
            padding: 20px;
            border-top: 1px solid rgba(0, 255, 255, 0.2);
            display: flex;
            gap: 15px;
            align-items: flex-end;
        }

        .chat-input {
            flex: 1;
            min-height: 44px;
            max-height: 120px;
            padding: 12px 18px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 22px;
            color: var(--text-primary);
            resize: none;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            line-height: 1.4;
        }

        .chat-send-btn {
            width: 44px;
            height: 44px;
            background: linear-gradient(45deg, var(--primary-cyan), var(--primary-blue));
            border: none;
            border-radius: 50%;
            color: #000;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .chat-send-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(0, 255, 255, 0.4);
        }

        .record-selector {
            background: var(--card-bg);
            border: 1px solid var(--border-glow);
            border-radius: 20px;
            padding: 25px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .record-item-chat {
            padding: 15px;
            background: rgba(0, 255, 255, 0.05);
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .record-item-chat:hover {
            background: rgba(0, 255, 255, 0.1);
            border-color: var(--primary-cyan);
            transform: translateY(-2px);
        }

        .record-item-chat.selected {
            background: rgba(0, 255, 255, 0.2);
            border-color: var(--primary-cyan);
            box-shadow: 0 5px 15px rgba(0, 255, 255, 0.3);
        }

        /* Advanced rPPG Record Viewer */
        .record-viewer-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        .record-viewer-content {
            background: var(--card-bg);
            border: 2px solid var(--border-glow);
            border-radius: 25px;
            width: 100%;
            max-width: 1400px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 40px;
            position: relative;
        }

        .record-viewer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(0, 255, 255, 0.2);
        }

        .close-viewer {
            width: 40px;
            height: 40px;
            background: rgba(255, 0, 128, 0.2);
            border: 1px solid var(--accent-pink);
            border-radius: 50%;
            color: var(--accent-pink);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s ease;
        }

        .close-viewer:hover {
            background: var(--accent-pink);
            color: #000;
        }

        .waveform-container {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
            height: 300px;
        }

        .waveform-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .waveform-btn {
            padding: 8px 16px;
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 20px;
            color: var(--primary-cyan);
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
        }

        .waveform-btn:hover, .waveform-btn.active {
            background: var(--primary-cyan);
            color: #000;
        }

        /* Enhanced Social Styles */
        .social-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }

        .social-feed-section {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .post-composer {
            background: var(--card-bg);
            border: 1px solid var(--border-glow);
            border-radius: 20px;
            padding: 25px;
        }

        .composer-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .composer-tools {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .composer-tool {
            padding: 8px 15px;
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 15px;
            color: var(--primary-cyan);
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .composer-tool:hover {
            background: rgba(0, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .social-sidebar {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .trending-section {
            background: var(--card-bg);
            border: 1px solid var(--border-glow);
            border-radius: 20px;
            padding: 25px;
        }

        .trending-item {
            padding: 12px 0;
            border-bottom: 1px solid rgba(0, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .trending-item:hover {
            color: var(--primary-cyan);
            transform: translateX(5px);
        }

        .trending-item:last-child {
            border-bottom: none;
        }

        .post-item {
            background: var(--card-bg);
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 20px;
            padding: 25px;
            transition: all 0.3s ease;
        }

        .post-item:hover {
            border-color: var(--primary-cyan);
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.1);
        }

        .post-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .post-avatar {
            width: 45px;
            height: 45px;
            background: linear-gradient(45deg, var(--accent-green), var(--primary-blue));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: #fff;
        }

        .post-meta {
            flex: 1;
        }

        .post-author {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 3px;
        }

        .post-time {
            font-size: 12px;
            color: var(--text-muted);
        }

        .post-content {
            margin: 15px 0;
            line-height: 1.6;
        }

        .post-actions {
            display: flex;
            gap: 20px;
            align-items: center;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid rgba(0, 255, 255, 0.1);
        }

        .action-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border: 1px solid;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-like {
            border-color: var(--accent-pink);
            color: var(--accent-pink);
        }

        .btn-like:hover, .btn-like.liked {
            background: var(--accent-pink);
            color: #000;
        }

        .btn-comment {
            border-color: var(--primary-blue);
            color: var(--primary-blue);
        }

        .btn-comment:hover {
            background: var(--primary-blue);
            color: #000;
        }

        .btn-share {
            border-color: var(--accent-green);
            color: var(--accent-green);
        }

        .btn-share:hover {
            background: var(--accent-green);
            color: #000;
        }

        /* rPPG Records Enhanced Display */
        .record-item {
            background: var(--card-bg);
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .record-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--accent-green), transparent);
            animation: recordScan 4s linear infinite;
        }

        @keyframes recordScan {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .record-item:hover {
            border-color: var(--primary-cyan);
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.1);
            transform: translateY(-3px);
        }

        .record-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .record-id {
            font-family: 'Orbitron', monospace;
            color: var(--primary-cyan);
            font-weight: 600;
            font-size: 16px;
        }

        .record-time {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .record-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .record-metric {
            text-align: center;
            padding: 15px;
            background: rgba(0, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(0, 255, 255, 0.1);
        }

        .record-metric-value {
            font-family: 'Orbitron', monospace;
            font-size: 18px;
            font-weight: 700;
            color: var(--primary-cyan);
            margin-bottom: 5px;
        }

        .record-metric-label {
            font-size: 10px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .record-quality {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }

        .quality-bar {
            flex: 1;
            height: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            overflow: hidden;
        }

        .quality-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-pink), var(--accent-orange), var(--accent-green));
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .quality-label {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        /* Download Section */
        .download-section {
            text-align: center;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 136, 0, 0.1));
            border: 2px solid var(--accent-gold);
            border-radius: 25px;
            padding: 50px;
            margin: 40px 0;
        }

        .download-title {
            font-family: 'Orbitron', monospace;
            font-size: 36px;
            color: var(--accent-gold);
            margin-bottom: 20px;
            font-weight: 700;
        }

        .download-subtitle {
            color: var(--text-secondary);
            font-size: 18px;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .download-btn {
            display: inline-flex;
            align-items: center;
            gap: 15px;
            padding: 20px 40px;
            background: linear-gradient(45deg, var(--accent-gold), var(--accent-orange));
            border: none;
            border-radius: 15px;
            color: #000;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            margin: 10px;
        }

        .download-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(255, 215, 0, 0.4);
        }

        .download-icon {
            font-size: 24px;
        }

        /* Contact & Map Styles */
        .contact-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-top: 30px;
        }

        .contact-info {
            background: var(--card-bg);
            border: 1px solid var(--border-glow);
            border-radius: 20px;
            padding: 30px;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .contact-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, var(--primary-cyan), var(--primary-blue));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            font-weight: 700;
        }

        .map-container {
            background: var(--card-bg);
            border: 1px solid var(--border-glow);
            border-radius: 20px;
            padding: 20px;
            height: 400px;
            overflow: hidden;
        }

        #map {
            width: 100%;
            height: 100%;
            border-radius: 15px;
        }

        /* Educational Content Styles */
        .education-section {
            background: linear-gradient(135deg, rgba(0, 128, 255, 0.05), rgba(0, 255, 255, 0.05));
            border: 1px solid var(--primary-blue);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .education-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
        }

        .education-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, var(--primary-blue), var(--primary-cyan));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .education-title {
            font-family: 'Orbitron', monospace;
            font-size: 24px;
            color: var(--primary-blue);
            font-weight: 600;
        }

        .education-content {
            line-height: 1.8;
            color: var(--text-primary);
        }

        .education-feature {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            margin: 20px 0;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            border-left: 3px solid var(--primary-blue);
        }

        .feature-icon {
            color: var(--primary-cyan);
            font-size: 18px;
            margin-top: 2px;
        }

        /* Utility Classes */
        .loading {
            text-align: center;
            padding: 60px;
            color: var(--primary-cyan);
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(0, 255, 255, 0.1);
            border-top: 4px solid var(--primary-cyan);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 25px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: rgba(255, 0, 128, 0.1);
            border: 1px solid var(--accent-pink);
            border-radius: 10px;
            padding: 20px;
            color: var(--accent-pink);
            margin: 20px 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .success-message {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid var(--accent-green);
            border-radius: 10px;
            padding: 20px;
            color: var(--accent-green);
            margin: 20px 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .card-grid {
                grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            }

            .contact-grid {
                grid-template-columns: 1fr;
            }

            .ai-chat-container {
                grid-template-columns: 1fr;
                height: auto;
            }

            .social-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .app-header {
                padding: 20px 25px;
            }

            .header-content {
                flex-direction: column;
                gap: 20px;
            }

            .header-nav {
                gap: 5px;
                padding: 5px;
            }

            .nav-item {
                padding: 8px 12px;
                font-size: 11px;
            }

            .content-area {
                padding: 25px;
            }

            .card-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .login-container {
                padding: 30px 25px;
                margin: 20px;
            }

            .panel-title {
                font-size: 32px;
            }

            .record-viewer-content {
                padding: 20px;
                margin: 20px;
            }
        }

        @keyframes logoSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Stars for constellation effect */
        .star:nth-child(1) { top: 10%; left: 20%; animation-delay: 0s; }
        .star:nth-child(2) { top: 20%; left: 80%; animation-delay: 1s; }
        .star:nth-child(3) { top: 60%; left: 30%; animation-delay: 2s; }
        .star:nth-child(4) { top: 80%; left: 70%; animation-delay: 0.5s; }
        .star:nth-child(5) { top: 40%; left: 60%; animation-delay: 1.5s; }
    </style>
</head>
<body>
    <div class="neural-background">
        <div class="neural-nodes"></div>
    </div>
    <div class="grid-overlay"></div>
    <div class="constellation">
        <div class="star"></div>
        <div class="star"></div>
        <div class="star"></div>
        <div class="star"></div>
        <div class="star"></div>
    </div>

    <div class="app-container">
        <!-- Login Screen -->
        <div class="login-screen" id="loginScreen">
            <div class="login-container">
                <div class="logo-section">
                    <div class="logo-icon">R</div>
                    <div class="app-title">RayVita-Synapse</div>
                    <div class="app-subtitle">ÂÖàËøõÁ•ûÁªèÂÅ•Â∫∑ÂàÜÊûêÂπ≥Âè∞<br>Êó†Êé•Ëß¶ÂÅ•Â∫∑ÁõëÊµã‰∏éAIÊ¥ûÂØü</div>
                </div>

                <form id="authForm">
                    <div class="form-group">
                        <label class="form-label">ÈÇÆÁÆ±Âú∞ÂùÄ</label>
                        <input type="email" class="form-input" id="email" required placeholder="your.email@domain.com">
                    </div>

                    <div class="form-group">
                        <label class="form-label">ÂØÜÁ†Å</label>
                        <input type="password" class="form-input" id="password" required placeholder="ËæìÂÖ•ÊÇ®ÁöÑÂØÜÁ†Å">
                    </div>

                    <div class="form-group" id="nicknameGroup" style="display: none;">
                        <label class="form-label">ÊòæÁ§∫ÂêçÁß∞</label>
                        <input type="text" class="form-input" id="nickname" placeholder="ÊÇ®ÁöÑÊòæÁ§∫ÂêçÁß∞">
                    </div>

                    <button type="submit" class="auth-button" id="authButton">
                        Êé•ÂÖ•Á•ûÁªèÁΩëÁªú
                    </button>

                    <div class="auth-toggle">
                        RayVitaÊñ∞Áî®Êà∑? <a href="#" id="toggleAuth">ÂàõÂª∫Á•ûÁªèÊ°£Ê°à</a>
                    </div>
                </form>

                <div id="authMessage"></div>
            </div>
        </div>

        <!-- Main Application -->
        <div class="main-app" id="mainApp">
            <!-- Enhanced Header -->
            <header class="app-header">
                <div class="header-content">
                    <div class="header-logo">
                        <div class="header-logo-icon">R</div>
                        <div>
                            <div class="header-title">RayVita-Synapse</div>
                            <div style="font-size: 12px; color: var(--text-secondary); letter-spacing: 1px;">Á•ûÁªèÂÅ•Â∫∑ÂàÜÊûê</div>
                        </div>
                    </div>

                    <nav class="header-nav">
                        <div class="nav-item active" data-panel="dashboard">‰ª™Ë°®Êùø</div>
                        <div class="nav-item" data-panel="records">rPPGËÆ∞ÂΩï</div>
                        <div class="nav-item" data-panel="ai-chat">AIÂØπËØù</div>
                        <div class="nav-item" data-panel="analysis">AIÂàÜÊûê</div>
                        <div class="nav-item" data-panel="social">Á§æ‰∫§Âä®ÊÄÅ</div>
                        <div class="nav-item" data-panel="about">ÂÖ≥‰∫érPPG</div>
                        <div class="nav-item" data-panel="download">Ëé∑ÂèñÂ∫îÁî®</div>
                        <div class="nav-item" data-panel="contact">ËÅîÁ≥ªÊàë‰ª¨</div>
                    </nav>

                    <div class="header-user">
                        <div class="user-avatar" id="userAvatar">U</div>
                        <div>
                            <div id="userName" style="font-weight: 600;">Áî®Êà∑</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Á•ûÁªèID: <span id="userId">--</span></div>
                        </div>
                        <button class="logout-btn" onclick="logout()">ÈÄÄÂá∫</button>
                    </div>
                </div>
            </header>

            <!-- Enhanced Content Area -->
            <main class="content-area">
                <!-- Dashboard Panel -->
                <div class="panel active" id="dashboard">
                    <div class="panel-header">
                        <h1 class="panel-title">Á•ûÁªèÂÅ•Â∫∑‰ª™Ë°®Êùø</h1>
                        <p class="panel-subtitle">Âü∫‰∫éÂÖàËøõrPPGÊäÄÊúØÁöÑÂÆûÊó∂ÁîüÁâ©ÊµãÈáèÂàÜÊûêÂèäAIÈ©±Âä®ÁöÑÂÅ•Â∫∑Ê¥ûÂØü</p>
                    </div>

                    <div class="card-grid">
                        <!-- Enhanced Vital Signs Card -->
                        <div class="neural-card featured">
                            <div class="card-header">
                                <div>
                                    <h3 class="card-title">ÁîüÂëΩ‰ΩìÂæÅÁü©Èòµ</h3>
                                    <div class="card-subtitle">ÂÆûÊó∂ÁîüÁâ©ÊµãÈáèÁõëÊéß</div>
                                </div>
                                <div class="card-icon">üíó</div>
                            </div>
                            <div class="metrics-grid" id="vitalMetrics">
                                <!-- Metrics will be populated here -->
                            </div>
                        </div>

                        <!-- Heart Rate Chart -->
                        <div class="neural-card">
                            <div class="card-header">
                                <div>
                                    <h3 class="card-title">ÂøÉÂæãËäÇÂæãÂàÜÊûê</h3>
                                    <div class="card-subtitle">ÂøÉÁéáÂèòÂºÇÊÄßË∂ãÂäø</div>
                                </div>
                                <div class="card-icon">üìà</div>
                            </div>
                            <div class="chart-container">
                                <canvas id="heartRateChart"></canvas>
                            </div>
                        </div>

                        <!-- HRV Analysis -->
                        <div class="neural-card">
                            <div class="card-header">
                                <div>
                                    <h3 class="card-title">HRVÁ•ûÁªèÊ®°Âºè</h3>
                                    <div class="card-subtitle">Ëá™‰∏ªÁ•ûÁªèÁ≥ªÁªüÂàÜÊûê</div>
                                </div>
                                <div class="card-icon">üß†</div>
                            </div>
                            <div class="chart-container">
                                <canvas id="hrvChart"></canvas>
                            </div>
                        </div>

                        <!-- SpO2 Monitoring -->
                        <div class="neural-card">
                            <div class="card-header">
                                <div>
                                    <h3 class="card-title">Ë°ÄÊ∞ßÈ•±ÂíåÂ∫¶</h3>
                                    <div class="card-subtitle">Ë°ÄÊ∂≤Ê∞ßÂêàÊ∞¥Âπ≥</div>
                                </div>
                                <div class="card-icon">ü´Å</div>
                            </div>
                            <div class="chart-container">
                                <canvas id="spo2Chart"></canvas>
                            </div>
                        </div>

                        <!-- Signal Quality Assessment -->
                        <div class="neural-card">
                            <div class="card-header">
                                <div>
                                    <h3 class="card-title">‰ø°Âè∑Ë¥®ÈáèÁü©Èòµ</h3>
                                    <div class="card-subtitle">rPPG‰ø°Âè∑ÂàÜÊûêÊåáÊ†á</div>
                                </div>
                                <div class="card-icon">üì°</div>
                            </div>
                            <div class="chart-container">
                                <canvas id="qualityChart"></canvas>
                            </div>
                        </div>

                        <!-- Recent Activity -->
                        <div class="neural-card">
                            <div class="card-header">
                                <div>
                                    <h3 class="card-title">ÊúÄËøëÁ•ûÁªèÊ¥ªÂä®</h3>
                                    <div class="card-subtitle">ÊúÄÊñ∞ÂÅ•Â∫∑ÊµãÈáèËÆ∞ÂΩï</div>
                                </div>
                                <div class="card-icon">‚ö°</div>
                            </div>
                            <div id="recentActivity">
                                <!-- Recent measurements will be populated here -->
                            </div>
                        </div>
                    </div>

                    <div id="loadingDashboard" class="loading" style="display: none;">
                        <div class="spinner"></div>
                        <div>Ê≠£Âú®ÂêåÊ≠•Á•ûÁªèÊï∞ÊçÆÊµÅ...</div>
                    </div>
                </div>

                <!-- Enhanced rPPG Records Panel -->
                <div class="panel" id="records">
                    <div class="panel-header">
                        <h1 class="panel-title">rPPGÊ£ÄÊµãËÆ∞ÂΩï</h1>
                        <p class="panel-subtitle">ÂÖ®Èù¢ÂàÜÊûêÊÇ®ÁöÑÂÖâÁîµÂÆπÁßØËÑâÊêèÊ≥¢ÊµãÈáèËÆ∞ÂΩïÂíå‰ø°Âè∑Ë¥®ÈáèËØÑ‰º∞</p>
                    </div>

                    <div class="neural-card">
                        <div class="card-header">
                            <div>
                                <h3 class="card-title">ÊµãÈáèÂéÜÂè≤ËÆ∞ÂΩï</h3>
                                <div class="card-subtitle">ËØ¶ÁªÜrPPG‰ºöËØùËÆ∞ÂΩï</div>
                            </div>
                            <div class="card-icon">üìä</div>
                        </div>

                        <div class="metrics-grid" style="margin-bottom: 30px;">
                            <div class="metric-item">
                                <div class="metric-value" id="totalSessions">--</div>
                                <div class="metric-label">ÊÄª‰ºöËØùÊï∞</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-value" id="avgHeartRate">--</div>
                                <div class="metric-label">Âπ≥ÂùáÂøÉÁéá</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-value" id="avgConfidence">--</div>
                                <div class="metric-label">Âπ≥ÂùáÁΩÆ‰ø°Â∫¶</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-value" id="lastMeasurement">--</div>
                                <div class="metric-label">ÊúÄËøëÊµãÈáè</div>
                            </div>
                        </div>

                        <div id="recordsList">
                            <!-- Records will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- AI Chat Panel -->
                <div class="panel" id="ai-chat">
                    <div class="panel-header">
                        <h1 class="panel-title">AIÂÅ•Â∫∑È°æÈóÆ</h1>
                        <p class="panel-subtitle">‰∏éAIËøõË°åÊô∫ËÉΩÂØπËØùÔºåËé∑Âèñ‰∏™ÊÄßÂåñÂÅ•Â∫∑Âª∫ËÆÆÂíåÊ∑±Â∫¶Êï∞ÊçÆÂàÜÊûê</p>
                    </div>

                    <div class="ai-chat-container">
                        <div class="chat-interface">
                            <div class="chat-header">
                                <div style="font-size: 24px;">ü§ñ</div>
                                <div>
                                    <div style="font-weight: 700; font-size: 18px;">RayVita AI ÂÅ•Â∫∑È°æÈóÆ</div>
                                    <div style="font-size: 14px; opacity: 0.8;">Âú®Á∫ø ‚Ä¢ Áî±DeepSeekÈ©±Âä®</div>
                                </div>
                            </div>

                            <div class="chat-messages" id="chatMessages">
                                <div class="message ai">
                                    <div>üëã ÊÇ®Â•ΩÔºÅÊàëÊòØRayVita AIÂÅ•Â∫∑È°æÈóÆ„ÄÇÊàëÂèØ‰ª•Â∏ÆÂä©ÊÇ®Ôºö</div>
                                    <div style="margin-top: 10px;">
                                        ‚Ä¢ üíì ÂàÜÊûêÊÇ®ÁöÑÂøÉÁéáÂíåHRVÊï∞ÊçÆ<br>
                                        ‚Ä¢ üìä Ëß£ËØªÁâπÂÆöÊµãÈáèËÆ∞ÂΩï<br>
                                        ‚Ä¢ üí° Êèê‰æõ‰∏™ÊÄßÂåñÂÅ•Â∫∑Âª∫ËÆÆ<br>
                                        ‚Ä¢ üè• ËØÑ‰º∞ÊÇ®ÁöÑÂøÉË°ÄÁÆ°ÂÅ•Â∫∑Áä∂ÊÄÅ
                                    </div>
                                    <div style="margin-top: 10px; color: var(--accent-green);">ËØ∑ÈÄâÊã©Âè≥‰æßÁöÑËÆ∞ÂΩïËøõË°åÊ∑±Â∫¶ÂàÜÊûêÔºåÊàñÁõ¥Êé•ÂêëÊàëÊèêÈóÆÔºÅ</div>
                                </div>
                            </div>

                            <div class="chat-input-area">
                                <textarea
                                    class="chat-input"
                                    id="chatInput"
                                    placeholder="ËØ∑ËæìÂÖ•ÊÇ®ÁöÑÂÅ•Â∫∑ÈóÆÈ¢òÊàñÈÄâÊã©ËÆ∞ÂΩïËøõË°åÂàÜÊûê..."
                                    rows="1"
                                ></textarea>
                                <button class="chat-send-btn" onclick="sendMessage()">
                                    ‚û§
                                </button>
                            </div>
                        </div>

                        <div class="record-selector">
                            <h4 style="color: var(--primary-cyan); margin-bottom: 15px; font-family: 'Orbitron', monospace;">ÈÄâÊã©ËÆ∞ÂΩïÂàÜÊûê</h4>
                            <div id="chatRecordsList">
                                <!-- Records for chat selection will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Enhanced AI Analysis Panel -->
                <div class="panel" id="analysis">
                    <div class="panel-header">
                        <h1 class="panel-title">AIÁ•ûÁªèÂàÜÊûê</h1>
                        <p class="panel-subtitle">Âü∫‰∫éDeepSeek AIÂíåÊú∫Âô®Â≠¶‰π†ÁÆóÊ≥ïÁöÑÈ´òÁ∫ßÂÅ•Â∫∑Ê¥ûÂØü</p>
                    </div>

                    <div class="neural-card">
                        <div class="card-header">
                            <div>
                                <h3 class="card-title">ÂÅ•Â∫∑ÂàÜÊûêÂºïÊìé</h3>
                                <div class="card-subtitle">AIÈ©±Âä®ÁöÑÁîüÁâ©ÊµãÈáèÊ¥ûÂØü</div>
                            </div>
                            <div class="card-icon">ü§ñ</div>
                        </div>

                        <button class="auth-button" onclick="performAIAnalysis()" style="margin-bottom: 30px;">
                            üß† ÁîüÊàêÈ´òÁ∫ßAIÂÅ•Â∫∑ÂàÜÊûê
                        </button>

                        <div id="aiAnalysisContent">
                            <div style="border: 2px dashed rgba(0, 255, 255, 0.3); text-align: center; padding: 40px; border-radius: 20px; background: rgba(0, 255, 255, 0.02);">
                                <div style="font-size: 48px; margin-bottom: 20px;">üî¨</div>
                                <h4 style="color: var(--primary-cyan); margin-bottom: 15px; font-family: 'Orbitron', monospace;">ÂáÜÂ§áÁ•ûÁªèÂàÜÊûê</h4>
                                <p style="color: var(--text-secondary);">ÁÇπÂáª‰∏äÊñπÊåâÈíÆÁîüÊàêÂü∫‰∫éÊÇ®ÁöÑrPPGÊµãÈáè„ÄÅÂøÉÁéáÂèòÂºÇÊÄßÊ®°ÂºèÂíåÁîüÁêÜÊåáÊ†áÁöÑÁªºÂêàAIÊ¥ûÂØü„ÄÇ</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Social Panel -->
                <div class="panel" id="social">
                    <div class="panel-header">
                        <h1 class="panel-title">ÂÅ•Â∫∑Á§æ‰∫§ÁΩëÁªú</h1>
                        <p class="panel-subtitle">‰∏éÂÅ•Â∫∑Á§æÂå∫ËøûÊé•ÔºåÂàÜ‰∫´ÂÅ•Â∫∑Ê¥ûÂØüÔºåÂú®ÊÇ®ÁöÑÂÅ•Â∫∑‰πãÊóÖ‰∏≠‰øùÊåÅÂä®Âäõ</p>
                    </div>

                    <div class="social-container">
                        <div class="social-feed-section">
                            <!-- Post Composer -->
                            <div class="post-composer">
                                <div class="composer-header">
                                    <div class="post-avatar" id="composerAvatar">U</div>
                                    <div style="flex: 1;">
                                        <textarea
                                            class="form-textarea"
                                            id="postText"
                                            placeholder="ÂàÜ‰∫´ÊÇ®ÁöÑÂÅ•Â∫∑ÂøÉÂæóÊàñ‰ªäÊó•ÊÑüÂèó..."
                                            rows="3"
                                        ></textarea>
                                    </div>
                                </div>

                                <div class="composer-tools">
                                    <div class="composer-tool">
                                        <span>üìä</span>
                                        <span>ÂÅ•Â∫∑Êï∞ÊçÆ</span>
                                    </div>
                                    <div class="composer-tool">
                                        <span>üì∑</span>
                                        <span>ÁÖßÁâá</span>
                                    </div>
                                    <div class="composer-tool">
                                        <span>üìç</span>
                                        <span>‰ΩçÁΩÆ</span>
                                    </div>
                                    <div class="composer-tool">
                                        <span>üòä</span>
                                        <span>ÂøÉÊÉÖ</span>
                                    </div>
                                </div>

                                <button class="action-button" onclick="createPost()">
                                    üìù ÂèëÂ∏ÉÂÅ•Â∫∑Âä®ÊÄÅ
                                </button>
                            </div>

                            <!-- Social Feed -->
                            <div id="socialFeed">
                                <!-- Posts will be populated here -->
                            </div>
                        </div>

                        <div class="social-sidebar">
                            <!-- Trending Topics -->
                            <div class="trending-section">
                                <h4 style="color: var(--primary-cyan); margin-bottom: 20px; font-family: 'Orbitron', monospace;">üî• ÂÅ•Â∫∑ÁÉ≠Èó®ËØùÈ¢ò</h4>
                                <div class="trending-item"># ÂøÉÁéáÂÅ•Â∫∑</div>
                                <div class="trending-item"># rPPGÊäÄÊúØ</div>
                                <div class="trending-item"># ÂÅ•Â∫∑ÁîüÊ¥ªÊñπÂºè</div>
                                <div class="trending-item"># ÂéãÂäõÁÆ°ÁêÜ</div>
                                <div class="trending-item"># ËøêÂä®ÂÅ•Â∫∑</div>
                                <div class="trending-item"># Áù°Áú†Ë¥®Èáè</div>
                            </div>

                            <!-- Personal Stats -->
                            <div class="trending-section">
                                <h4 style="color: var(--primary-cyan); margin-bottom: 20px; font-family: 'Orbitron', monospace;">üìà ÊàëÁöÑÂÅ•Â∫∑ÁªüËÆ°</h4>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                                    <span>‰ªäÊó•ÊµãÈáè:</span>
                                    <span style="color: var(--accent-green);" id="todayMeasurements">0</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                                    <span>Êú¨Âë®Âπ≥ÂùáÂøÉÁéá:</span>
                                    <span style="color: var(--primary-cyan);" id="weeklyAvgHR">--</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                                    <span>ÂÅ•Â∫∑ËØÑÂàÜ:</span>
                                    <span style="color: var(--accent-gold);" id="healthScore">--</span>
                                </div>
                            </div>

                            <!-- Friends Network -->
                            <div class="trending-section">
                                <h4 style="color: var(--primary-cyan); margin-bottom: 20px; font-family: 'Orbitron', monospace;">üë• ÂÅ•Â∫∑ÁΩëÁªú</h4>
                                <div id="friendsNetwork">
                                    <!-- Friends will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- About rPPG Panel -->
                <div class="panel" id="about">
                    <div class="panel-header">
                        <h1 class="panel-title">ÂÖ≥‰∫érPPGÊäÄÊúØ</h1>
                        <p class="panel-subtitle">‰∫ÜËß£ËøúÁ®ãÂÖâÁîµÂÆπÁßØËÑâÊêèÊ≥¢ÊäÄÊúØÂèäÂÖ∂Âú®Êó†Êé•Ëß¶ÂÅ•Â∫∑ÁõëÊµã‰∏≠ÁöÑÈù©ÂëΩÊÄßÂΩ±Âìç</p>
                    </div>

                    <div class="education-section">
                        <div class="education-header">
                            <div class="education-icon">üî¨</div>
                            <div class="education-title">‰ªÄ‰πàÊòØrPPGÔºü</div>
                        </div>
                        <div class="education-content">
                            <p><strong>ËøúÁ®ãÂÖâÁîµÂÆπÁßØËÑâÊêèÊ≥¢ÊäÄÊúØ(rPPG)</strong>ÊòØ‰∏ÄÈ°πÁ™ÅÁ†¥ÊÄßÊäÄÊúØÔºåËÉΩÂ§ü‰ªÖ‰ΩøÁî®ÊëÑÂÉèÂ§¥ËøõË°åÊó†Êé•Ëß¶ÁöÑÁîüÁêÜ‰ø°Âè∑ÊµãÈáè„ÄÇÈÄöËøáÂàÜÊûêË°ÄÊ∂≤Âæ™ÁéØÂºïËµ∑ÁöÑ‰∫∫‰ΩìÁöÆËÇ§ÂæÆÂ¶ôÈ¢úËâ≤ÂèòÂåñÔºårPPGÂèØ‰ª•ÂáÜÁ°ÆÊ£ÄÊµãÂøÉÁéá„ÄÅÂøÉÁéáÂèòÂºÇÊÄßÔºåÁîöËá≥Ë°ÄÊ∞ßÈ•±ÂíåÂ∫¶Ê∞¥Âπ≥„ÄÇ</p>

                            <div class="education-feature">
                                <div class="feature-icon">üì±</div>
                                <div>
                                    <strong>Âü∫‰∫éÊëÑÂÉèÂ§¥ÁöÑÊ£ÄÊµã</strong><br>
                                    ‰ΩøÁî®ÊÇ®ËÆæÂ§áÁöÑÊëÑÂÉèÂ§¥ÊçïËé∑Èù¢ÈÉ®ÁöÆËÇ§‰∏≠‰∏éÂøÉË∑≥ÂØπÂ∫îÁöÑÂæÆËßÇÈ¢úËâ≤ÂèòÂåñ„ÄÇ
                                </div>
                            </div>

                            <div class="education-feature">
                                <div class="feature-icon">‚ö°</div>
                                <div>
                                    <strong>ÂÆûÊó∂Â§ÑÁêÜ</strong><br>
                                    ÂÖàËøõÁÆóÊ≥ïÂÆûÊó∂Â§ÑÁêÜËßÜÈ¢ëÂ∏ßÔºå‰ª•ÂåªÁñóÁ∫ßÁ≤æÂ∫¶ÊèêÂèñÂøÉË°ÄÁÆ°‰ø°Âè∑„ÄÇ
                                </div>
                            </div>

                            <div class="education-feature">
                                <div class="feature-icon">üß†</div>
                                <div>
                                    <strong>AIÂ¢ûÂº∫ÂàÜÊûê</strong><br>
                                    Êú∫Âô®Â≠¶‰π†Ê®°ÂûãËøáÊª§Âô™Â£∞Âπ∂Â¢ûÂº∫‰ø°Âè∑Ë¥®ÈáèÔºåÂÆûÁé∞ÂèØÈù†ÁöÑÂÅ•Â∫∑ÊµãÈáè„ÄÇ
                                </div>
                            </div>

                            <div class="education-feature">
                                <div class="feature-icon">üåê</div>
                                <div>
                                    <strong>Êó†Êé•Ëß¶‰æøÊç∑</strong><br>
                                    Êó†ÈúÄÂèØÁ©øÊà¥ËÆæÂ§áÊàñ‰º†ÊÑüÂô® - Âè™ÈúÄÂ∞ÜÊëÑÂÉèÂ§¥ÂØπÂáÜÂç≥ÂèØËé∑ÂæóÂç≥Êó∂ÂÅ•Â∫∑Ê¥ûÂØü„ÄÇ
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="education-section">
                        <div class="education-header">
                            <div class="education-icon">üì±</div>
                            <div class="education-title">RayVitaÂ∫îÁî®Ê¶ÇËø∞</div>
                        </div>
                        <div class="education-content">
                            <p><strong>RayVita</strong>ÊòØ‰∏ÄÊ¨æËûçÂêàÂÅ•Â∫∑ÁßëÊäÄ‰∏éÁ§æ‰∫§‰∫íÂä®ÁöÑÊô∫ËÉΩÂÅ•Â∫∑App„ÄÇÂÖ∂Ê†∏ÂøÉÂäüËÉΩÂåÖÊã¨Âü∫‰∫érPPGÊäÄÊúØÁöÑÊó†Êé•Ëß¶ÂøÉÁéáÊ£ÄÊµãÂíåÂÅ•Â∫∑Á§æ‰∫§Á≥ªÁªüÔºåÊèêÂçáÂÅ•Â∫∑ÁÆ°ÁêÜÁöÑË∂£Âë≥ÊÄß‰∏éÊåÅÁª≠ÊÄß„ÄÇ</p>

                            <div class="education-feature">
                                <div class="feature-icon">‚ù§Ô∏è</div>
                                <div>
                                    <strong>Êó†Êé•Ëß¶ÂøÉÁéáÊ£ÄÊµã</strong><br>
                                    ÂÖàËøõrPPGÊäÄÊúØÂÆûÁé∞‰ΩøÁî®ËÆæÂ§áÊëÑÂÉèÂ§¥ÁöÑÂÆûÊó∂ÂøÉÁéáÊµãÈáè - Êó†ÈúÄÈ¢ùÂ§ñÁ°¨‰ª∂„ÄÇ
                                </div>
                            </div>

                            <div class="education-feature">
                                <div class="feature-icon">üë•</div>
                                <div>
                                    <strong>ÂÅ•Â∫∑Á§æ‰∫§ÁΩëÁªú</strong><br>
                                    ÂàÜ‰∫´ÊÇ®ÁöÑÂÅ•Â∫∑‰πãÊóÖÔºå‰∏éÊúãÂèãËøûÊé•ÔºåÂèÇ‰∏éÊîØÊåÅÊÄßÂÅ•Â∫∑Á§æÂå∫ÔºåËÆ©ÂÅ•Ë∫´ÂèòÂæóÊúâË∂£‰∏îÂèØÊåÅÁª≠„ÄÇ
                                </div>
                            </div>

                            <div class="education-feature">
                                <div class="feature-icon">üé®</div>
                                <div>
                                    <strong>Material YouËÆæËÆ°</strong><br>
                                    ÈááÁî®Material YouËÆæËÆ°ÂéüÂàôÁöÑÁæéËßÇÁé∞‰ª£UI‰ΩìÈ™åÔºåÂÖºÈ°æÁßëÂ≠¶ÂáÜÁ°ÆÊÄßÂíåÂçìË∂äÂèØÁî®ÊÄß„ÄÇ
                                </div>
                            </div>

                            <div class="education-feature">
                                <div class="feature-icon">üîÆ</div>
                                <div>
                                    <strong>Êú™Êù•ËÆ°ÁÆóÊú∫ËßÜËßâ</strong><br>
                                    Êàë‰ª¨ÊåÅÁª≠ÂºÄÂèëÂÖàËøõCVÊñπÊ≥ïÔºåÊèê‰æõÊõ¥ÂÖ®Èù¢ÁöÑÂÅ•Â∫∑ÁõëÊµãÂäüËÉΩ„ÄÇ
                                </div>
                            </div>

                            <p style="margin-top: 25px;"><strong>ÁõÆÊ†áÁî®Êà∑Ôºö</strong> RayVitaÈùûÂ∏∏ÈÄÇÂêàÊÉ≥Ë¶Å‰ΩøÁî®Â∞ñÁ´ØÊäÄÊúØÁõëÊµãÂøÉË°ÄÁÆ°ÂÅ•Â∫∑ÔºåÂêåÊó∂‰∏éÊîØÊåÅÊÄßÁ§æÂå∫‰øùÊåÅËÅîÁ≥ªÁöÑÂπ¥ËΩª„ÄÅÂÖ≥Ê≥®ÂÅ•Â∫∑ÁöÑÁî®Êà∑Áæ§‰Ωì„ÄÇ</p>
                        </div>
                    </div>
                </div>

                <!-- Download App Panel -->
                <div class="panel" id="download">
                    <div class="panel-header">
                        <h1 class="panel-title">Ëé∑ÂèñRayVitaÂ∫îÁî®</h1>
                        <p class="panel-subtitle">‰∏ãËΩΩRayVitaÁßªÂä®Â∫îÁî®ÔºåÂºÄÂßãÊÇ®ÁöÑÊó†Êé•Ëß¶ÂÅ•Â∫∑ÁõëÊµã‰πãÊóÖ</p>
                    </div>

                    <div class="download-section">
                        <div class="download-title">üöÄ RayVitaÁßªÂä®Â∫îÁî®</div>
                        <div class="download-subtitle">
                            ‰ΩìÈ™åÂÅ•Â∫∑ÁõëÊµãÁöÑÊú™Êù•ÔºåÊê≠ËΩΩÊàë‰ª¨ÂÖàËøõÁöÑrPPGÊäÄÊúØ„ÄÇ<br>
                            ÂÆûÊó∂ÂøÉÁéáÊ£ÄÊµã„ÄÅAIÊ¥ûÂØüÂíåÁ§æ‰∫§ÂÅ•Â∫∑ÂäüËÉΩ - Â∞ΩÂú®ÊÇ®ÁöÑÂè£Ë¢ã‰∏≠„ÄÇ
                        </div>
                        <a href="#" class="download-btn" onclick="downloadAPK()">
                            <div class="download-icon">üì±</div>
                            <div>
                                <div style="font-size: 14px; opacity: 0.8;">Áõ¥Êé•‰∏ãËΩΩ</div>
                                <div>RayVita.apk</div>
                            </div>
                        </a>
                    </div>

                    <div class="card-grid">
                        <div class="neural-card">
                            <div class="card-header">
                                <div>
                                    <h3 class="card-title">Â∫îÁî®ÁâπËâ≤ÂäüËÉΩ</h3>
                                    <div class="card-subtitle">RayVitaÁöÑÁã¨Áâπ‰πãÂ§Ñ</div>
                                </div>
                                <div class="card-icon">‚ú®</div>
                            </div>
                            <div class="education-feature">
                                <div class="feature-icon">üì∑</div>
                                <div>
                                    <strong>Âü∫‰∫éÊëÑÂÉèÂ§¥ÁöÑÁõëÊµã</strong><br>
                                    Â∞ÜÊÇ®ÁöÑÊâãÊú∫ÂèòÊàêÂÅ•Â∫∑ÁõëÊµãËÆæÂ§á
                                </div>
                            </div>
                            <div class="education-feature">
                                <div class="feature-icon">ü§ñ</div>
                                <div>
                                    <strong>AIÂÅ•Â∫∑Ê¥ûÂØü</strong><br>
                                    Ëé∑Âæó‰∏™ÊÄßÂåñÂÅ•Â∫∑Âª∫ËÆÆ
                                </div>
                            </div>
                            <div class="education-feature">
                                <div class="feature-icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
                                <div>
                                    <strong>Á§æ‰∫§ÂÅ•Â∫∑ÁΩëÁªú</strong><br>
                                    ‰∏éÊúãÂèãÂíåÂÆ∂‰∫∫ÂàÜ‰∫´ÂíåÊØîËæÉ
                                </div>
                            </div>
                        </div>

                        <div class="neural-card">
                            <div class="card-header">
                                <div>
                                    <h3 class="card-title">Á≥ªÁªüË¶ÅÊ±Ç</h3>
                                    <div class="card-subtitle">ËÆæÂ§áÂÖºÂÆπÊÄß</div>
                                </div>
                                <div class="card-icon">‚öôÔ∏è</div>
                            </div>
                            <div style="line-height: 1.8; color: var(--text-primary);">
                                <p><strong>AndroidËÆæÂ§á:</strong></p>
                                <ul style="margin-left: 20px; margin-bottom: 15px;">
                                    <li>Android 8.0 (APIÁ∫ßÂà´26) ÊàñÊõ¥È´òÁâàÊú¨</li>
                                    <li>ÈúÄË¶ÅÂâçÁΩÆÊëÑÂÉèÂ§¥</li>
                                    <li>Âª∫ËÆÆÊúÄÂ∞ë3GB RAM</li>
                                    <li>ÊîØÊåÅARMv7ÊàñARM64Êû∂ÊûÑ</li>
                                </ul>
                                <p><strong>Êé®ËçêÈÖçÁΩÆ:</strong></p>
                                <ul style="margin-left: 20px;">
                                    <li>Android 11.0 ÊàñÊõ¥Êñ∞ÁâàÊú¨</li>
                                    <li>4GBÊàñÊõ¥Â§öRAM</li>
                                    <li>ËâØÂ•ΩÁöÑÂâçÁΩÆÊëÑÂÉèÂ§¥Ë¥®Èáè</li>
                                    <li>Á®≥ÂÆöÁöÑÁΩëÁªúËøûÊé•</li>
                                </ul>
                            </div>
                        </div>

                        <div class="neural-card">
                            <div class="card-header">
                                <div>
                                    <h3 class="card-title">Â∫îÁî®‰ªãÁªç</h3>
                                    <div class="card-subtitle">RayVitaÊ†∏ÂøÉÂäüËÉΩ</div>
                                </div>
                                <div class="card-icon">üìñ</div>
                            </div>
                            <div style="line-height: 1.8; color: var(--text-primary);">
                                <p>RayVitaÊòØ‰∏ÄÊ¨æËûçÂêàÂÅ•Â∫∑ÁßëÊäÄ‰∏éÁ§æ‰∫§‰∫íÂä®ÁöÑÊô∫ËÉΩÂÅ•Â∫∑App„ÄÇ</p>

                                <div class="education-feature">
                                    <div class="feature-icon">üíì</div>
                                    <div>
                                        <strong>rPPGÊó†Êé•Ëß¶Ê£ÄÊµã</strong><br>
                                        Áî®Êà∑ÈÄöËøáÊëÑÂÉèÂ§¥Âç≥ÂèØÂÆûÊó∂ÊµãÈáèÂøÉÁéáÔºåÊó†ÈúÄ‰Ω©Êà¥‰ªª‰ΩïËÆæÂ§á
                                    </div>
                                </div>

                                <div class="education-feature">
                                    <div class="feature-icon">üåü</div>
                                    <div>
                                        <strong>ÂÅ•Â∫∑Á§æ‰∫§Á≥ªÁªü</strong><br>
                                        ÊîØÊåÅÂä®ÊÄÅÂèëÂ∏É„ÄÅÂ•ΩÂèã‰∫íÂä®‰∏éÂÅ•Â∫∑Êï∞ÊçÆÂàÜ‰∫´ÔºåÊèêÂçáÂÅ•Â∫∑ÁÆ°ÁêÜÁöÑË∂£Âë≥ÊÄß
                                    </div>
                                </div>

                                <div class="education-feature">
                                    <div class="feature-icon">üéØ</div>
                                    <div>
                                        <strong>È´òÁ≤æÂ∫¶AIÊ®°Âûã</strong><br>
                                        È©±Âä®ÁöÑÁîüÁêÜ‰ø°Âè∑ÂàÜÊûê‰∏éMaterial YouÈ£éÊ†ºËÆæËÆ°ÁöÑÁé∞‰ª£ÂåñUI‰ΩìÈ™å
                                    </div>
                                </div>

                                <p style="margin-top: 20px; color: var(--accent-green);">
                                    <strong>ÈÄÇÂêàÂÖ≥Ê≥®ÂøÉÁéáÂÅ•Â∫∑ÁöÑÂπ¥ËΩªÁî®Êà∑Áæ§‰ΩìÔºåÂÖºÈ°æÁßëÂ≠¶ÊÄß‰∏éÂèØÁî®ÊÄß„ÄÇ</strong>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Contact Panel -->
                <div class="panel" id="contact">
                    <div class="panel-header">
                        <h1 class="panel-title">ËÅîÁ≥ª‰∏éÊîØÊåÅ</h1>
                        <p class="panel-subtitle">‰∏éÊàë‰ª¨ÁöÑÂõ¢ÈòüËÅîÁ≥ªÔºåËé∑ÂèñÊîØÊåÅ„ÄÅÂêà‰Ωú‰ºô‰º¥ÂÖ≥Á≥ªÊàñ‰∏ÄËà¨Âí®ËØ¢</p>
                    </div>

                    <div class="contact-grid">
                        <div class="contact-info">
                            <h3 style="color: var(--primary-cyan); margin-bottom: 25px; font-family: 'Orbitron', monospace;">ËÅîÁ≥ªÊàë‰ª¨</h3>

                            <div class="contact-item">
                                <div class="contact-icon">üìß</div>
                                <div>
                                    <div style="font-weight: 600;">ÈÇÆ‰ª∂ÊîØÊåÅ</div>
                                    <div style="color: var(--text-secondary);">support@rayvita.com</div>
                                </div>
                            </div>

                            <div class="contact-item">
                                <div class="contact-icon">üíº</div>
                                <div>
                                    <div style="font-weight: 600;">ÂïÜÂä°Âí®ËØ¢</div>
                                    <div style="color: var(--text-secondary);">business@rayvita.com</div>
                                </div>
                            </div>

                            <div class="contact-item">
                                <div class="contact-icon">üî¨</div>
                                <div>
                                    <div style="font-weight: 600;">Á†îÁ©∂Âêà‰Ωú</div>
                                    <div style="color: var(--text-secondary);">research@rayvita.com</div>
                                </div>
                            </div>

                            <div class="contact-item">
                                <div class="contact-icon">üì±</div>
                                <div>
                                    <div style="font-weight: 600;">ÊäÄÊúØÊîØÊåÅ</div>
                                    <div style="color: var(--text-secondary);">+86 400-123-4567</div>
                                </div>
                            </div>

                            <div class="contact-item">
                                <div class="contact-icon">üè¢</div>
                                <div>
                                    <div style="font-weight: 600;">ÂÖ¨Âè∏Âú∞ÂùÄ</div>
                                    <div style="color: var(--text-secondary);">Âåó‰∫¨Â∏ÇÊµ∑Ê∑ÄÂå∫‰∏≠ÂÖ≥ÊùëÁßëÊäÄÂõ≠</div>
                                </div>
                            </div>
                        </div>

                        <div class="map-container">
                            <div id="map"></div>
                        </div>
                    </div>

                    <div class="neural-card" style="margin-top: 40px;">
                        <div class="card-header">
                            <div>
                                <h3 class="card-title">ÂÖ¨Âè∏‰ø°ÊÅØ</h3>
                                <div class="card-subtitle">ÂÖ≥‰∫éRayVitaÁßëÊäÄ</div>
                            </div>
                            <div class="card-icon">üè¢</div>
                        </div>
                        <div style="line-height: 1.8; color: var(--text-primary);">
                            <p><strong>RayVitaÁßëÊäÄ</strong>ÊòØÊó†Êé•Ëß¶ÂÅ•Â∫∑ÁõëÊµãËß£ÂÜ≥ÊñπÊ°àÁöÑÈ¢ÜÂÖàÂàõÊñ∞ËÄÖ„ÄÇÊàë‰ª¨Áî±ËÆ°ÁÆóÊú∫ËßÜËßâÁ†îÁ©∂‰∫∫ÂëòÂíåÂåªÁñó‰øùÂÅ•‰∏ì‰∏ö‰∫∫Â£´ÁªÑÊàêÁöÑÂõ¢ÈòüÂàõÁ´ãÔºåËá¥Âäõ‰∫éÈÄöËøáÂ∞ñÁ´ØÁöÑrPPGÊäÄÊúØËÆ©ÊØè‰∏™‰∫∫ÈÉΩËÉΩËé∑ÂæóÂÖàËøõÁöÑÂÅ•Â∫∑ÁõëÊµã„ÄÇ</p>

                            <p style="margin-top: 20px;">Êàë‰ª¨ÁöÑ‰ΩøÂëΩÊòØÈÄöËøáÊ∂àÈô§ÂØπÊòÇË¥µÂèØÁ©øÊà¥ËÆæÂ§áÊàñÂåªÁñóËÆæÂ§áÁöÑÈúÄÊ±ÇÊù•ÂÆûÁé∞ÂÅ•Â∫∑ÁõëÊµãÁöÑÊ∞ë‰∏ªÂåñÔºåÂêåÊó∂‰øùÊåÅÊúÄÈ´òÁöÑÂáÜÁ°ÆÊÄßÂíåÂèØÈù†ÊÄßÊ†áÂáÜ„ÄÇÊàë‰ª¨Áõ∏‰ø°ÊØè‰∏™‰∫∫ÈÉΩÂ∫îËØ•ÈöèÊó∂ÈöèÂú∞Ëé∑ÂæóËá™Â∑±ÁöÑÂÅ•Â∫∑Êï∞ÊçÆ„ÄÇ</p>

                            <div style="margin-top: 25px; padding: 20px; background: rgba(0, 255, 255, 0.05); border-radius: 10px; border-left: 3px solid var(--primary-cyan);">
                                <strong>üéØ Êàë‰ª¨ÁöÑÊÑøÊôØÔºö</strong> ÂàõÂª∫‰∏Ä‰∏™ÂÅ•Â∫∑ÁõëÊµãÂ∞±ÂÉèÁúãÊâãÊú∫‰∏ÄÊ†∑ÁÆÄÂçïÁöÑ‰∏ñÁïåÔºåÈÄöËøáÂàõÊñ∞ÊäÄÊúØÂíåÁ§æÂå∫ÊîØÊåÅÔºåËµãËÉΩ‰∏™‰∫∫ÊéåÊéßËá™Â∑±ÁöÑÂøÉË°ÄÁÆ°ÂÅ•Â∫∑„ÄÇ
                            </div>

                            <div style="margin-top: 20px; padding: 20px; background: rgba(0, 255, 136, 0.05); border-radius: 10px; border-left: 3px solid var(--accent-green);">
                                <strong>üåü RayVita-SynapseÔºö</strong> ‰Ωú‰∏∫RayVitaÁ≥ªÂàóÁöÑÁΩëÈ°µÁ´ØËΩªÈáèÂåñÁâàÊú¨ÔºåÂÆö‰Ωç‰∏∫Ë∑®Âπ≥Âè∞ÂÅ•Â∫∑Êï∞ÊçÆÂèØËßÜÂåñ‰∏é‰∫§‰∫í‰∏≠Êû¢Ôºå‰∏∫Áî®Êà∑Êèê‰æõÂÖ®Êñπ‰ΩçÁöÑÂÅ•Â∫∑ÁÆ°ÁêÜ‰ΩìÈ™å„ÄÇ
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Advanced rPPG Record Viewer Modal -->
        <div class="record-viewer-modal" id="recordViewerModal">
            <div class="record-viewer-content">
                <div class="record-viewer-header">
                    <div>
                        <h3 style="color: var(--primary-cyan); font-family: 'Orbitron', monospace; font-size: 24px;">rPPGËÆ∞ÂΩïËØ¶ÁªÜÂàÜÊûê</h3>
                        <div style="color: var(--text-secondary); margin-top: 5px;" id="recordViewerSubtitle">‰ºöËØùËØ¶ÁªÜ‰ø°ÊÅØÂíåÊ≥¢ÂΩ¢ÂàÜÊûê</div>
                    </div>
                    <div class="close-viewer" onclick="closeRecordViewer()">‚úï</div>
                </div>

                <div id="recordViewerDetails">
                    <!-- Record details will be populated here -->
                </div>

                <div class="waveform-controls">
                    <div class="waveform-btn active" data-type="rppg">rPPG‰ø°Âè∑</div>
                    <div class="waveform-btn" data-type="heartrate">ÂøÉÁéáË∂ãÂäø</div>
                    <div class="waveform-btn" data-type="hrv">HRVÂàÜÊûê</div>
                    <div class="waveform-btn" data-type="quality">‰ø°Âè∑Ë¥®Èáè</div>
                    <div class="waveform-btn" data-type="fft">È¢ëË∞±ÂàÜÊûê</div>
                </div>

                <div class="waveform-container">
                    <canvas id="waveformChart"></canvas>
                </div>

                <div id="recordAnalysis" style="margin-top: 30px;">
                    <!-- Analysis will be populated here -->
                </div>
            </div>
        </div>

    </div>

    <script>
        // Global variables
        let currentUser = null;
        let healthData = [];
        let socialPosts = [];
        let chatMessages = [];
        let selectedRecord = null;
        let charts = {};
        let waveformChart = null;
        let map = null;
        let isLoggedIn = false;
        let isRegistering = false;

        // API Configuration
        const RAYVITA_BASE_URL = 'http://47.96.237.130:5000/api/';
        const DEEPSEEK_API_KEY = 'sk-0dd7411c6de74f119e9a06be144a89d6';
        const DEEPSEEK_BASE_URL = 'https://api.deepseek.com/';

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            checkAuthStatus();
            createStarField();
            initializeMap();
        });

        function createStarField() {
            const constellation = document.querySelector('.constellation');
            for (let i = 0; i < 20; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.top = Math.random() * 100 + '%';
                star.style.left = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                constellation.appendChild(star);
            }
        }

        function initializeMap() {
            // Initialize map when contact panel is first opened
            setTimeout(() => {
                if (!map) {
                    map = L.map('map').setView([39.9042, 116.4074], 13);
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: ' OpenStreetMap contributors'
                    }).addTo(map);

                    L.marker([39.9042, 116.4074]).addTo(map)
                        .bindPopup('<strong>RayVitaÁßëÊäÄÊÄªÈÉ®</strong><br>Âåó‰∫¨Â∏ÇÊµ∑Ê∑ÄÂå∫‰∏≠ÂÖ≥ÊùëÁßëÊäÄÂõ≠')
                        .openPopup();
                }
            }, 1000);
        }

        function setupEventListeners() {
            // Auth form submission
            document.getElementById('authForm').addEventListener('submit', handleAuth);

            // Toggle between login and register
            document.getElementById('toggleAuth').addEventListener('click', toggleAuthMode);

            // Navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    const panel = this.dataset.panel;
                    switchPanel(panel);
                });
            });

            // Chat input auto-resize
            const chatInput = document.getElementById('chatInput');
            chatInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 120) + 'px';
            });

            // Chat input enter to send
            chatInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // Waveform controls
            document.querySelectorAll('.waveform-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.waveform-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    updateWaveform(this.dataset.type);
                });
            });
        }

        function checkAuthStatus() {
            // Check if user is already logged in (localStorage)
            const savedUser = localStorage.getItem('rayVitaUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showMainApp();
            }
        }

        async function handleAuth(e) {
            e.preventDefault();

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const nickname = document.getElementById('nickname').value;

            try {
                let response;
                if (isRegistering) {
                    response = await fetch(`${RAYVITA_BASE_URL}user/register`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ email, password, nickname })
                    });
                } else {
                    response = await fetch(`${RAYVITA_BASE_URL}user/login`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ email, password })
                    });
                }

                const data = await response.json();

                if (response.ok) {
                    if (isRegistering) {
                        showMessage('Á•ûÁªèÊ°£Ê°àÂàõÂª∫ÊàêÂäüÔºÅËØ∑ÁôªÂΩï‰ª•ËÆøÈóÆÊÇ®ÁöÑ‰ª™Ë°®Êùø„ÄÇ', 'success');
                        toggleAuthMode();
                    } else {
                        // Get user details
                        const userResponse = await fetch(`${RAYVITA_BASE_URL}user/${data.user_id}`);
                        const userData = await userResponse.json();

                        currentUser = userData;
                        localStorage.setItem('rayVitaUser', JSON.stringify(currentUser));
                        showMainApp();
                    }
                } else {
                    showMessage(data.msg || 'Ë∫´‰ªΩÈ™åËØÅÂ§±Ë¥•„ÄÇËØ∑Ê£ÄÊü•ÊÇ®ÁöÑÂá≠ÊçÆ„ÄÇ', 'error');
                }
                } catch (error) {
                console.error('Auth error:', error);
                showMessage('ÁΩëÁªúÈîôËØØ„ÄÇËØ∑Ê£ÄÊü•ÊÇ®ÁöÑËøûÊé•Âπ∂ÈáçËØï„ÄÇ', 'error');
            }
        }

        function toggleAuthMode() {
            isRegistering = !isRegistering;
            const button = document.getElementById('authButton');
            const toggle = document.getElementById('toggleAuth');
            const nicknameGroup = document.getElementById('nicknameGroup');

            if (isRegistering) {
                button.textContent = 'ÂàõÂª∫Á•ûÁªèÊ°£Ê°à';
                toggle.innerHTML = 'Â∑≤ÊúâË¥¶Êà∑? <a href="#">Êé•ÂÖ•Á•ûÁªèÁΩëÁªú</a>';
                nicknameGroup.style.display = 'block';
            } else {
                button.textContent = 'Êé•ÂÖ•Á•ûÁªèÁΩëÁªú';
                toggle.innerHTML = 'RayVitaÊñ∞Áî®Êà∑? <a href="#">ÂàõÂª∫Á•ûÁªèÊ°£Ê°à</a>';
                nicknameGroup.style.display = 'none';
            }

            // Clear form
            document.getElementById('authForm').reset();
            clearMessages();
        }

        function showMainApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            isLoggedIn = true;

            // Update user info in header
            document.getElementById('userName').textContent = currentUser.nickname || currentUser.email;
            document.getElementById('userId').textContent = currentUser.user_id;
            document.getElementById('userAvatar').textContent = (currentUser.nickname || currentUser.email).charAt(0).toUpperCase();
            document.getElementById('composerAvatar').textContent = (currentUser.nickname || currentUser.email).charAt(0).toUpperCase();

            // Load initial data
            loadHealthData();
            loadSocialData();
            updateChatRecords();
        }

        function logout() {
            localStorage.removeItem('rayVitaUser');
            currentUser = null;
            isLoggedIn = false;

            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'flex';

            // Clear form
            document.getElementById('authForm').reset();
            clearMessages();
        }

        function switchPanel(panelName) {
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-panel="${panelName}"]`).classList.add('active');

            // Show panel
            document.querySelectorAll('.panel').forEach(panel => {
                panel.classList.remove('active');
            });
            document.getElementById(panelName).classList.add('active');

            // Load panel-specific data
            if (panelName === 'social') {
                loadSocialData();
            } else if (panelName === 'records') {
                loadHealthData();
            } else if (panelName === 'ai-chat') {
                updateChatRecords();
            } else if (panelName === 'contact') {
                setTimeout(() => {
                    if (map) {
                        map.invalidateSize();
                    }
                }, 100);
            }
        }

        async function loadHealthData() {
            if (!currentUser) return;

            const loading = document.getElementById('loadingDashboard');
            if (loading) loading.style.display = 'block';

            try {
                const response = await fetch(`${RAYVITA_BASE_URL}health_measurements/user/${currentUser.user_id}`);
                if (response.ok) {
                    healthData = await response.json();
                    healthData.sort((a, b) => new Date(b.createdAt || b.timestamp) - new Date(a.createdAt || a.timestamp));
                    renderDashboard();
                    renderRecords();
                    updateChatRecords();
                    updateSocialStats();
                } else {
                    // Generate sample data for demo
                    generateSampleHealthData();
                }
            } catch (error) {
                console.error('Error loading health data:', error);
                generateSampleHealthData();
            } finally {
                if (loading) loading.style.display = 'none';
            }
        }

        function generateSampleHealthData() {
            // Generate realistic sample data for demonstration
            healthData = [];
            const now = new Date();

            for (let i = 0; i < 15; i++) {
                const date = new Date(now.getTime() - i * 3600000 * Math.random() * 24);
                const baseHR = 70 + Math.random() * 30;
                const confidence = 0.85 + Math.random() * 0.15;

                healthData.push({
                    sessionId: `demo-${i}`,
                    user_id: currentUser.user_id,
                    timestamp: date.getTime(),
                    createdAt: date.toISOString(),
                    heartRate: baseHR + (Math.random() - 0.5) * 10,
                    confidence: confidence,
                    frameCount: Math.floor(200 + Math.random() * 100),
                    processingTimeMs: Math.floor(1000 + Math.random() * 500),
                    hrvResult: {
                        rmssd: 20 + Math.random() * 40,
                        sdnn: 30 + Math.random() * 30,
                        pnn50: Math.random() * 20,
                        stressIndex: Math.random() * 0.8
                    },
                    spo2Result: {
                        spo2: 96 + Math.random() * 4
                    },
                    signalQuality: {
                        illuminationQuality: 0.7 + Math.random() * 0.3,
                        motionArtifact: Math.random() * 0.3
                    },
                    // Generate sample waveform data
                    rppgSignal: generateSampleWaveform(300, 'rppg'),
                    syncStatus: Math.random() > 0.5 ? 'synced' : 'pending'
                });
            }

            renderDashboard();
            renderRecords();
            updateChatRecords();
            updateSocialStats();
        }

        function generateSampleWaveform(length, type) {
            const data = [];
            const baseFreq = type === 'rppg' ? 0.02 : 0.01;

            for (let i = 0; i < length; i++) {
                let value = 0;

                if (type === 'rppg') {
                    value = Math.sin(i * baseFreq * 2 * Math.PI) * 0.8 +
                           Math.sin(i * baseFreq * 4 * Math.PI) * 0.3 +
                           (Math.random() - 0.5) * 0.2;
                } else if (type === 'heartrate') {
                    value = 70 + Math.sin(i * baseFreq * Math.PI) * 15 + (Math.random() - 0.5) * 5;
                } else if (type === 'quality') {
                    value = 0.8 + Math.sin(i * baseFreq * Math.PI) * 0.15 + (Math.random() - 0.5) * 0.1;
                }

                data.push(value);
            }

            return data;
        }

        function renderDashboard() {
            if (healthData.length === 0) {
                document.getElementById('vitalMetrics').innerHTML = '<p style="text-align: center; color: var(--text-secondary);">ÊöÇÊó†ÂÅ•Â∫∑Êï∞ÊçÆ„ÄÇËØ∑‰ΩøÁî®RayVitaÂ∫îÁî®ÂºÄÂßãÊµãÈáè„ÄÇ</p>';
                return;
            }

            // Render vital metrics
            renderVitalMetrics();
            renderRecentActivity();

            // Render charts
            setTimeout(() => {
                renderHeartRateChart();
                renderHRVChart();
                renderSpO2Chart();
                renderQualityChart();
            }, 100);
        }

        function renderVitalMetrics() {
            const latest = healthData[0];
            const previous = healthData[1] || latest;
            const container = document.getElementById('vitalMetrics');

            const heartRateTrend = latest.heartRate - (previous.heartRate || 0);
            const spo2Trend = latest.spo2Result ? latest.spo2Result.spo2 - (previous.spo2Result?.spo2 || 0) : 0;
            const confidenceTrend = latest.confidence - (previous.confidence || 0);

            container.innerHTML = `
                <div class="metric-item">
                    <div class="metric-value">${latest.heartRate ? latest.heartRate.toFixed(1) : '--'}</div>
                    <div class="metric-label">ÂøÉÁéá (BPM)</div>
                    <div class="metric-trend ${heartRateTrend > 0 ? 'trend-up' : heartRateTrend < 0 ? 'trend-down' : 'trend-stable'}">
                        ${heartRateTrend > 0 ? '‚Üó' : heartRateTrend < 0 ? '‚Üò' : '‚Üí'} ${Math.abs(heartRateTrend).toFixed(1)}
                    </div>
                </div>
                <div class="metric-item">
                    <div class="metric-value">${latest.spo2Result ? latest.spo2Result.spo2.toFixed(1) : '--'}</div>
                    <div class="metric-label">Ë°ÄÊ∞ß (%)</div>
                    <div class="metric-trend ${spo2Trend > 0 ? 'trend-up' : spo2Trend < 0 ? 'trend-down' : 'trend-stable'}">
                        ${spo2Trend > 0 ? '‚Üó' : spo2Trend < 0 ? '‚Üò' : '‚Üí'} ${Math.abs(spo2Trend).toFixed(1)}
                    </div>
                </div>
                <div class="metric-item">
                    <div class="metric-value">${latest.hrvResult ? latest.hrvResult.rmssd.toFixed(1) : '--'}</div>
                    <div class="metric-label">RMSSD (ms)</div>
                    <div class="metric-trend trend-${latest.hrvResult && latest.hrvResult.rmssd > 30 ? 'up' : 'down'}">
                        ${latest.hrvResult && latest.hrvResult.rmssd > 30 ? 'ËâØÂ•Ω' : 'ÂÖ≥Ê≥®'}
                    </div>
                </div>
                <div class="metric-item">
                    <div class="metric-value">${latest.confidence ? (latest.confidence * 100).toFixed(0) : '--'}</div>
                    <div class="metric-label">ÁΩÆ‰ø°Â∫¶ (%)</div>
                    <div class="metric-trend ${confidenceTrend > 0 ? 'trend-up' : confidenceTrend < 0 ? 'trend-down' : 'trend-stable'}">
                        ${confidenceTrend > 0 ? '‚Üó' : confidenceTrend < 0 ? '‚Üò' : '‚Üí'} ${Math.abs(confidenceTrend * 100).toFixed(0)}%
                    </div>
                </div>
                <div class="metric-item">
                    <div class="metric-value">${healthData.length}</div>
                    <div class="metric-label">ÊÄª‰ºöËØùÊï∞</div>
                    <div class="metric-trend trend-up">
                        Ê¥ªË∑É
                    </div>
                </div>
                <div class="metric-item">
                    <div class="metric-value">${latest.hrvResult ? latest.hrvResult.stressIndex.toFixed(2) : '--'}</div>
                    <div class="metric-label">ÂéãÂäõÊåáÊï∞</div>
                    <div class="metric-trend trend-${latest.hrvResult && latest.hrvResult.stressIndex < 0.5 ? 'up' : 'down'}">
                        ${latest.hrvResult && latest.hrvResult.stressIndex < 0.5 ? '‰Ωé' : '‰∏≠Á≠â'}
                    </div>
                </div>
            `;
        }

        function renderRecentActivity() {
            const container = document.getElementById('recentActivity');
            const recentData = healthData.slice(0, 5);

            if (recentData.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">ÊöÇÊó†ÊúÄËøëÊ¥ªÂä®</p>';
                return;
            }

            container.innerHTML = recentData.map(item => {
                const date = new Date(item.createdAt || item.timestamp);
                const timeAgo = getTimeAgo(date);

                return `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: rgba(0, 255, 255, 0.05); border-radius: 10px; margin-bottom: 10px; border-left: 3px solid var(--primary-cyan);">
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 5px;">
                                ÂøÉÁéá: ${item.heartRate ? item.heartRate.toFixed(1) : 'N/A'} BPM
                                ${item.spo2Result ? `‚Ä¢ Ë°ÄÊ∞ß: ${item.spo2Result.spo2.toFixed(1)}%` : ''}
                            </div>
                            <div style="font-size: 12px; color: var(--text-secondary);">
                                ${timeAgo} ‚Ä¢ ÁΩÆ‰ø°Â∫¶: ${item.confidence ? (item.confidence * 100).toFixed(0) : 'N/A'}%
                            </div>
                        </div>
                        <div style="color: var(--accent-green); font-size: 18px;">üíö</div>
                    </div>
                `;
            }).join('');
        }

        function renderRecords() {
            // Update statistics
            if (healthData.length > 0) {
                document.getElementById('totalSessions').textContent = healthData.length;
                document.getElementById('avgHeartRate').textContent = (healthData.reduce((sum, item) => sum + (item.heartRate || 0), 0) / healthData.length).toFixed(1);
                document.getElementById('avgConfidence').textContent = ((healthData.reduce((sum, item) => sum + (item.confidence || 0), 0) / healthData.length) * 100).toFixed(0) + '%';
                document.getElementById('lastMeasurement').textContent = getTimeAgo(new Date(healthData[0].createdAt || healthData[0].timestamp));
            }

            // Render records list
            const container = document.getElementById('recordsList');

            if (healthData.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 40px;">ÊöÇÊó†rPPGÊµãÈáèËÆ∞ÂΩï„ÄÇËØ∑‰ΩøÁî®RayVitaÂ∫îÁî®Êü•ÁúãÊÇ®ÁöÑÊï∞ÊçÆ„ÄÇ</p>';
                return;
            }

            container.innerHTML = healthData.map((item, index) => {
                const date = new Date(item.createdAt || item.timestamp);
                const qualityPercent = item.signalQuality ? Math.max(item.signalQuality.illuminationQuality * 100, 10) : 50;

                return `
                    <div class="record-item" onclick="openRecordViewer('${item.sessionId}')">
                        <div class="record-header">
                            <div class="record-id">‰ºöËØù ${String(index + 1).padStart(3, '0')}</div>
                            <div class="record-time">${date.toLocaleString('zh-CN')}</div>
                        </div>

                        <div class="record-metrics">
                            <div class="record-metric">
                                <div class="record-metric-value">${item.heartRate ? item.heartRate.toFixed(1) : 'N/A'}</div>
                                <div class="record-metric-label">ÂøÉÁéá</div>
                            </div>
                            <div class="record-metric">
                                <div class="record-metric-value">${item.spo2Result ? item.spo2Result.spo2.toFixed(1) : 'N/A'}</div>
                                <div class="record-metric-label">Ë°ÄÊ∞ß (%)</div>
                            </div>
                            <div class="record-metric">
                                <div class="record-metric-value">${item.hrvResult ? item.hrvResult.rmssd.toFixed(1) : 'N/A'}</div>
                                <div class="record-metric-label">RMSSD</div>
                            </div>
                            <div class="record-metric">
                                <div class="record-metric-value">${item.confidence ? (item.confidence * 100).toFixed(0) : 'N/A'}</div>
                                <div class="record-metric-label">ÁΩÆ‰ø°Â∫¶</div>
                            </div>
                            <div class="record-metric">
                                <div class="record-metric-value">${item.frameCount || 'N/A'}</div>
                                <div class="record-metric-label">Â∏ßÊï∞</div>
                            </div>
                            <div class="record-metric">
                                <div class="record-metric-value">${item.processingTimeMs || 'N/A'}</div>
                                <div class="record-metric-label">Â§ÑÁêÜÊó∂Èó¥(ms)</div>
                            </div>
                        </div>

                        <div class="record-quality">
                            <div class="quality-label">‰ø°Âè∑Ë¥®Èáè:</div>
                            <div class="quality-bar">
                                <div class="quality-fill" style="width: ${qualityPercent}%"></div>
                            </div>
                            <div class="quality-label">${qualityPercent.toFixed(0)}%</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderHeartRateChart() {
            const ctx = document.getElementById('heartRateChart')?.getContext('2d');
            if (!ctx || healthData.length === 0) return;

            if (charts.heartRate) {
                charts.heartRate.destroy();
            }

            const gradient = ctx.createLinearGradient(0, 0, 0, 300);
            gradient.addColorStop(0, 'rgba(0, 255, 255, 0.4)');
            gradient.addColorStop(1, 'rgba(0, 255, 255, 0.05)');

            charts.heartRate = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: healthData.slice().reverse().map(item => new Date(item.createdAt || item.timestamp).toLocaleTimeString('zh-CN')),
                    datasets: [{
                        label: 'ÂøÉÁéá (BPM)',
                        data: healthData.slice().reverse().map(item => item.heartRate),
                        borderColor: '#00ffff',
                        backgroundColor: gradient,
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#00ffff',
                        pointBorderColor: '#ffffff',
                        pointRadius: 5,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#ffffff',
                                font: { family: 'Inter', size: 14 }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: '#ffffff',
                                font: { family: 'Inter' }
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        y: {
                            ticks: {
                                color: '#ffffff',
                                font: { family: 'Inter' }
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    },
                    animation: {
                        duration: 2000,
                        easing: 'easeInOutQuart'
                    }
                }
            });
        }

        function renderHRVChart() {
            const ctx = document.getElementById('hrvChart')?.getContext('2d');
            if (!ctx) return;

            if (charts.hrv) {
                charts.hrv.destroy();
            }

            const validData = healthData.filter(item => item.hrvResult);
            if (validData.length === 0) {
                ctx.fillStyle = '#ffffff';
                ctx.font = '16px Inter';
                ctx.textAlign = 'center';
                ctx.fillText('ÊöÇÊó†HRVÊï∞ÊçÆ', ctx.canvas.width / 2, ctx.canvas.height / 2);
                return;
            }

            charts.hrv = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['RMSSD', 'SDNN', 'pNN50', 'ÂéãÂäõÊåáÊï∞'],
                    datasets: validData.slice(0, 3).map((item, index) => ({
                        label: `‰ºöËØù ${index + 1}`,
                        data: [
                            Math.min(item.hrvResult.rmssd / 10, 100),
                            Math.min(item.hrvResult.sdnn / 5, 100),
                            item.hrvResult.pnn50 || 0,
                            Math.max(0, (1 - item.hrvResult.stressIndex) * 100)
                        ],
                        borderColor: ['#00ffff', '#0080ff', '#8000ff'][index],
                        backgroundColor: ['rgba(0, 255, 255, 0.1)', 'rgba(0, 128, 255, 0.1)', 'rgba(128, 0, 255, 0.1)'][index],
                        borderWidth: 3,
                        pointBackgroundColor: ['#00ffff', '#0080ff', '#8000ff'][index],
                        pointBorderColor: '#ffffff',
                        pointRadius: 4
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#ffffff',
                                font: { family: 'Inter', size: 14 }
                            }
                        }
                    },
                    scales: {
                        r: {
                            angleLines: { color: 'rgba(255, 255, 255, 0.2)' },
                            grid: { color: 'rgba(255, 255, 255, 0.2)' },
                            pointLabels: {
                                color: '#ffffff',
                                font: { family: 'Inter', size: 12 }
                            },
                            ticks: {
                                color: '#ffffff',
                                backdropColor: 'transparent'
                            },
                            beginAtZero: true,
                            max: 100
                        }
                    },
                    animation: {
                        duration: 2500,
                        easing: 'easeInOutElastic'
                    }
                }
            });
        }

        function renderSpO2Chart() {
            const ctx = document.getElementById('spo2Chart')?.getContext('2d');
            if (!ctx) return;

            if (charts.spo2) {
                charts.spo2.destroy();
            }

            const validData = healthData.filter(item => item.spo2Result);
            if (validData.length === 0) {
                ctx.fillStyle = '#ffffff';
                ctx.font = '16px Inter';
                ctx.textAlign = 'center';
                ctx.fillText('ÊöÇÊó†Ë°ÄÊ∞ßÊï∞ÊçÆ', ctx.canvas.width / 2, ctx.canvas.height / 2);
                return;
            }

            const gradient = ctx.createLinearGradient(0, 0, 0, 300);
            gradient.addColorStop(0, 'rgba(0, 255, 136, 0.3)');
            gradient.addColorStop(1, 'rgba(0, 255, 136, 0.05)');

            charts.spo2 = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: validData.slice().reverse().map(item => new Date(item.createdAt || item.timestamp).toLocaleTimeString('zh-CN')),
                    datasets: [{
                        label: 'Ë°ÄÊ∞ßÈ•±ÂíåÂ∫¶ (%)',
                        data: validData.slice().reverse().map(item => item.spo2Result.spo2),
                        borderColor: '#00ff88',
                        backgroundColor: gradient,
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#00ff88',
                        pointBorderColor: '#ffffff',
                        pointRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#ffffff',
                                font: { family: 'Inter', size: 14 }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: '#ffffff',
                                font: { family: 'Inter' }
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        y: {
                            ticks: {
                                color: '#ffffff',
                                font: { family: 'Inter' }
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            min: 95,
                            max: 100
                        }
                    }
                }
            });
        }

        function renderQualityChart() {
            const ctx = document.getElementById('qualityChart')?.getContext('2d');
            if (!ctx || healthData.length === 0) return;

            if (charts.quality) {
                charts.quality.destroy();
            }

            charts.quality = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: healthData.slice(0, 10).map((_, index) => `S${index + 1}`),
                    datasets: [{
                        label: 'ÂÖâÁÖßË¥®Èáè (%)',
                        data: healthData.slice(0, 10).map(item => item.signalQuality ? item.signalQuality.illuminationQuality * 100 : 50),
                        backgroundColor: 'rgba(0, 255, 255, 0.7)',
                        borderColor: '#00ffff',
                        borderWidth: 2,
                        borderRadius: 6
                    }, {
                        label: '‰ø°Âè∑Ê∏ÖÊô∞Â∫¶ (%)',
                        data: healthData.slice(0, 10).map(item => item.signalQuality ? (1 - (item.signalQuality.motionArtifact || 0)) * 100 : 80),
                        backgroundColor: 'rgba(255, 136, 0, 0.7)',
                        borderColor: '#ff8800',
                        borderWidth: 2,
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#ffffff',
                                font: { family: 'Inter', size: 14 }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: '#ffffff',
                                font: { family: 'Inter' }
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        y: {
                            ticks: {
                                color: '#ffffff',
                                font: { family: 'Inter' }
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }

        // Advanced Record Viewer Functions
        function openRecordViewer(sessionId) {
            const record = healthData.find(item => item.sessionId === sessionId);
            if (!record) return;

            selectedRecord = record;
            document.getElementById('recordViewerModal').style.display = 'flex';
            renderRecordDetails(record);
            updateWaveform('rppg');
        }

        function closeRecordViewer() {
            document.getElementById('recordViewerModal').style.display = 'none';
            selectedRecord = null;
            if (waveformChart) {
                waveformChart.destroy();
                waveformChart = null;
            }
        }

        function renderRecordDetails(record) {
            const date = new Date(record.createdAt || record.timestamp);
            const container = document.getElementById('recordViewerDetails');

            container.innerHTML = `
                <div class="card-grid dense" style="margin-bottom: 30px;">
                    <div class="neural-card">
                        <h4 style="color: var(--primary-cyan); margin-bottom: 20px;">üìä Âü∫Êú¨ÊåáÊ†á</h4>
                        <div class="metrics-grid">
                            <div class="metric-item">
                                <div class="metric-value">${record.heartRate ? record.heartRate.toFixed(1) : 'N/A'}</div>
                                <div class="metric-label">ÂøÉÁéá (BPM)</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-value">${record.confidence ? (record.confidence * 100).toFixed(0) : 'N/A'}</div>
                                <div class="metric-label">ÁΩÆ‰ø°Â∫¶ (%)</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-value">${record.frameCount || 'N/A'}</div>
                                <div class="metric-label">Â∏ßÊï∞</div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-value">${record.processingTimeMs || 'N/A'}</div>
                                <div class="metric-label">Â§ÑÁêÜÊó∂Èó¥</div>
                            </div>
                        </div>
                    </div>

                    <div class="neural-card">
                        <h4 style="color: var(--primary-cyan); margin-bottom: 20px;">üíì HRVÂàÜÊûê</h4>
                        ${record.hrvResult ? `
                            <div class="metrics-grid">
                                <div class="metric-item">
                                    <div class="metric-value">${record.hrvResult.rmssd.toFixed(1)}</div>
                                    <div class="metric-label">RMSSD (ms)</div>
                                </div>
                                <div class="metric-item">
                                    <div class="metric-value">${record.hrvResult.sdnn.toFixed(1)}</div>
                                    <div class="metric-label">SDNN (ms)</div>
                                </div>
                                <div class="metric-item">
                                    <div class="metric-value">${record.hrvResult.pnn50 ? record.hrvResult.pnn50.toFixed(1) : 'N/A'}</div>
                                    <div class="metric-label">pNN50 (%)</div>
                                </div>
                                <div class="metric-item">
                                    <div class="metric-value">${record.hrvResult.stressIndex.toFixed(2)}</div>
                                    <div class="metric-label">ÂéãÂäõÊåáÊï∞</div>
                                </div>
                            </div>
                        ` : '<p style="text-align: center; color: var(--text-secondary);">ÊöÇÊó†HRVÊï∞ÊçÆ</p>'}
                    </div>

                    <div class="neural-card">
                        <h4 style="color: var(--primary-cyan); margin-bottom: 20px;">ü´Å Ë°ÄÊ∞ßÂàÜÊûê</h4>
                        ${record.spo2Result ? `
                            <div class="metrics-grid">
                                <div class="metric-item">
                                    <div class="metric-value">${record.spo2Result.spo2.toFixed(1)}</div>
                                    <div class="metric-label">Ë°ÄÊ∞ßÈ•±ÂíåÂ∫¶ (%)</div>
                                </div>
                                <div class="metric-item">
                                    <div class="metric-value">${record.spo2Result.spo2 >= 98 ? '‰ºòÁßÄ' : record.spo2Result.spo2 >= 96 ? 'ËâØÂ•Ω' : 'ÂÖ≥Ê≥®'}</div>
                                    <div class="metric-label">ÂÅ•Â∫∑Áä∂ÊÄÅ</div>
                                </div>
                            </div>
                        ` : '<p style="text-align: center; color: var(--text-secondary);">ÊöÇÊó†Ë°ÄÊ∞ßÊï∞ÊçÆ</p>'}
                    </div>
                </div>

                <div class="neural-card">
                    <h4 style="color: var(--primary-cyan); margin-bottom: 20px;">üìà ÂÅ•Â∫∑ËØÑ‰º∞‰∏éÂª∫ËÆÆ</h4>
                    <div style="line-height: 1.8;">
                        ${generateHealthAssessment(record)}
                    </div>
                </div>
            `;
        }

        function generateHealthAssessment(record) {
            let assessment = '';

            // Heart Rate Assessment
            if (record.heartRate) {
                if (record.heartRate < 60) {
                    assessment += '<div class="education-feature"><div class="feature-icon" style="color: var(--accent-orange);">‚ö†Ô∏è</div><div><strong>ÂøÉÁéáÂÅè‰ΩéÔºö</strong>ÊÇ®ÁöÑÈùôÊÅØÂøÉÁéá‰Ωé‰∫éÊ≠£Â∏∏ËåÉÂõ¥„ÄÇÂ¶ÇÊûúÊÇ®‰∏çÊòØËÆ≠ÁªÉÊúâÁ¥†ÁöÑËøêÂä®ÂëòÔºåÂª∫ËÆÆÂí®ËØ¢ÂåªÁîü„ÄÇ</div></div>';
                } else if (record.heartRate > 100) {
                    assessment += '<div class="education-feature"><div class="feature-icon" style="color: var(--accent-pink);">üö®</div><div><strong>ÂøÉÁéáÂÅèÈ´òÔºö</strong>ÊÇ®ÁöÑÂøÉÁéáÈ´ò‰∫éÊ≠£Â∏∏ËåÉÂõ¥„ÄÇÂèØËÉΩÊòØÂéãÂäõ„ÄÅÂíñÂï°Âõ†ÊàñÂÖ∂‰ªñÂõ†Á¥†ÂØºËá¥ÁöÑ„ÄÇÂª∫ËÆÆ‰ºëÊÅØÂπ∂ÁõëÊµã„ÄÇ</div></div>';
                } else {
                    assessment += '<div class="education-feature"><div class="feature-icon" style="color: var(--accent-green);">‚úÖ</div><div><strong>ÂøÉÁéáÊ≠£Â∏∏Ôºö</strong>ÊÇ®ÁöÑÂøÉÁéáÂú®ÂÅ•Â∫∑ËåÉÂõ¥ÂÜÖÔºà60-100 BPMÔºâ„ÄÇ</div></div>';
                }
            }

            // HRV Assessment
            if (record.hrvResult) {
                if (record.hrvResult.rmssd > 30) {
                    assessment += '<div class="education-feature"><div class="feature-icon" style="color: var(--accent-green);">üíö</div><div><strong>HRVËâØÂ•ΩÔºö</strong>RMSSDÂÄºË°®ÊòéÊÇ®ÁöÑËá™‰∏ªÁ•ûÁªèÁ≥ªÁªüÂπ≥Ë°°ËâØÂ•ΩÔºåÂéãÂäõÁÆ°ÁêÜËÉΩÂäõËæÉÂº∫„ÄÇ</div></div>';
                } else {
                    assessment += '<div class="education-feature"><div class="feature-icon" style="color: var(--accent-orange);">‚ö†Ô∏è</div><div><strong>HRVÈúÄÂÖ≥Ê≥®Ôºö</strong>RMSSDÂÄºÂÅè‰ΩéÔºåÂèØËÉΩË°®ÊòéÂéãÂäõËæÉÂ§ßÊàñÈúÄË¶ÅÊõ¥Â§ö‰ºëÊÅØ„ÄÇÂª∫ËÆÆËøõË°åÊîæÊùæÁªÉ‰π†„ÄÇ</div></div>';
                }

                if (record.hrvResult.stressIndex > 0.6) {
                    assessment += '<div class="education-feature"><div class="feature-icon" style="color: var(--accent-pink);">üò∞</div><div><strong>ÂéãÂäõËæÉÂ§ßÔºö</strong>ÂéãÂäõÊåáÊï∞ËæÉÈ´òÔºåÂª∫ËÆÆËøõË°åÊ∑±ÂëºÂê∏„ÄÅÂÜ•ÊÉ≥ÊàñÂÖ∂‰ªñÊîæÊùæÊ¥ªÂä®„ÄÇ</div></div>';
                }
            }

            // SpO2 Assessment
            if (record.spo2Result) {
                if (record.spo2Result.spo2 >= 98) {
                    assessment += '<div class="education-feature"><div class="feature-icon" style="color: var(--accent-green);">ü´Å</div><div><strong>Ë°ÄÊ∞ß‰ºòÁßÄÔºö</strong>ÊÇ®ÁöÑË°ÄÊ∞ßÈ•±ÂíåÂ∫¶Âú®‰ºòÁßÄËåÉÂõ¥ÂÜÖÔºåÂëºÂê∏Á≥ªÁªüÂíåÂæ™ÁéØÁ≥ªÁªüÂ∑•‰ΩúËâØÂ•Ω„ÄÇ</div></div>';
                } else if (record.spo2Result.spo2 >= 96) {
                    assessment += '<div class="education-feature"><div class="feature-icon" style="color: var(--accent-green);">üëç</div><div><strong>Ë°ÄÊ∞ßÊ≠£Â∏∏Ôºö</strong>ÊÇ®ÁöÑË°ÄÊ∞ßÈ•±ÂíåÂ∫¶Âú®Ê≠£Â∏∏ËåÉÂõ¥ÂÜÖ„ÄÇ</div></div>';
                } else {
                    assessment += '<div class="education-feature"><div class="feature-icon" style="color: var(--accent-orange);">‚ö†Ô∏è</div><div><strong>Ë°ÄÊ∞ßÈúÄÂÖ≥Ê≥®Ôºö</strong>Ë°ÄÊ∞ßÈ•±ÂíåÂ∫¶Á®ç‰ΩéÔºåÂ¶ÇÊûúÊåÅÁª≠Â¶ÇÊ≠§ÔºåÂª∫ËÆÆÂí®ËØ¢ÂåªÁîü„ÄÇ</div></div>';
                }
            }

            // Signal Quality Assessment
            if (record.signalQuality) {
                const quality = record.signalQuality.illuminationQuality;
                if (quality > 0.8) {
                    assessment += '<div class="education-feature"><div class="feature-icon" style="color: var(--accent-green);">üì°</div><div><strong>‰ø°Âè∑Ë¥®Èáè‰ºòÁßÄÔºö</strong>ÊµãÈáèÁéØÂ¢ÉÂíåÊù°‰ª∂ËâØÂ•ΩÔºåÊï∞ÊçÆÂèØÈù†ÊÄßÈ´ò„ÄÇ</div></div>';
                } else if (quality > 0.6) {
                    assessment += '<div class="education-feature"><div class="feature-icon" style="color: var(--accent-orange);">üì∂</div><div><strong>‰ø°Âè∑Ë¥®Èáè‰∏ÄËà¨Ôºö</strong>Âª∫ËÆÆÂú®ÂÖâÁÖßÂÖÖË∂≥„ÄÅÁõ∏ÂØπÈùôÊ≠¢ÁöÑÁéØÂ¢É‰∏ãËøõË°åÊµãÈáè„ÄÇ</div></div>';
                } else {
                    assessment += '<div class="education-feature"><div class="feature-icon" style="color: var(--accent-pink);">üì±</div><div><strong>‰ø°Âè∑Ë¥®ÈáèÈúÄÊîπÂñÑÔºö</strong>Âª∫ËÆÆÊîπÂñÑÂÖâÁÖßÊù°‰ª∂Ôºå‰øùÊåÅÊµãÈáèÊó∂ÁöÑÁ®≥ÂÆöÊÄß„ÄÇ</div></div>';
                }
            }

            // General Recommendations
            assessment += `
                <div style="margin-top: 25px; padding: 20px; background: rgba(0, 255, 255, 0.05); border-radius: 15px; border-left: 4px solid var(--primary-cyan);">
                    <h5 style="color: var(--primary-cyan); margin-bottom: 15px;">üí° ‰∏™ÊÄßÂåñÂª∫ËÆÆ</h5>
                    <ul style="margin-left: 20px; line-height: 1.8;">
                        <li>‰øùÊåÅËßÑÂæãÁöÑ‰ΩúÊÅØÊó∂Èó¥ÔºåÁ°Æ‰øùÂÖÖË∂≥Áù°Áú†Ôºà7-9Â∞èÊó∂Ôºâ</li>
                        <li>ËøõË°åÈÄÇÈáèÊúâÊ∞ßËøêÂä®ÔºåÂ¶ÇÊï£Ê≠•„ÄÅÊ∏∏Ê≥≥ÊàñÈ™ëË°å</li>
                        <li>Â≠¶‰π†ÂéãÂäõÁÆ°ÁêÜÊäÄÂ∑ßÔºåÂ¶ÇÊ∑±ÂëºÂê∏„ÄÅÂÜ•ÊÉ≥ÊàñÁëú‰ºΩ</li>
                        <li>‰øùÊåÅÂùáË°°È•ÆÈ£üÔºåÈÄÇÂΩìÊéßÂà∂ÂíñÂï°Âõ†ÊëÑÂÖ•</li>
                        <li>ÂÆöÊúüËøõË°åÂÅ•Â∫∑Ê£ÄÊü•ÔºåÁõëÊµãÂøÉË°ÄÁÆ°ÂÅ•Â∫∑</li>
                    </ul>
                </div>
            `;

            return assessment;
        }

        function updateWaveform(type) {
            if (!selectedRecord) return;

            const ctx = document.getElementById('waveformChart').getContext('2d');

            if (waveformChart) {
                waveformChart.destroy();
            }

            let data = [];
            let label = '';
            let color = '#00ffff';
            let yAxisConfig = {};

            switch (type) {
                case 'rppg':
                    data = selectedRecord.rppgSignal || generateSampleWaveform(300, 'rppg');
                    label = 'rPPG‰ø°Âè∑Âº∫Â∫¶';
                    color = '#00ffff';
                    yAxisConfig = { min: -1, max: 1 };
                    break;
                case 'heartrate':
                    data = generateSampleWaveform(100, 'heartrate');
                    label = 'ÂøÉÁéáÂèòÂåñ (BPM)';
                    color = '#ff0080';
                    yAxisConfig = { min: 50, max: 120 };
                    break;
                case 'hrv':
                    if (selectedRecord.hrvResult) {
                        data = Array.from({length: 50}, (_, i) =>
                            selectedRecord.hrvResult.rmssd + Math.sin(i * 0.2) * 10 + (Math.random() - 0.5) * 5
                        );
                        label = 'HRV RMSSD (ms)';
                        color = '#8000ff';
                        yAxisConfig = { min: 0, max: 80 };
                    } else {
                        data = Array.from({length: 50}, () => 0);
                        label = 'HRVÊï∞ÊçÆ‰∏çÂèØÁî®';
                    }
                    break;
                case 'quality':
                    data = generateSampleWaveform(100, 'quality');
                    label = '‰ø°Âè∑Ë¥®ÈáèÊåáÊï∞';
                    color = '#00ff88';
                    yAxisConfig = { min: 0, max: 1 };
                    break;
                case 'fft':
                    data = Array.from({length: 50}, (_, i) => Math.exp(-i * 0.1) * (0.5 + Math.random() * 0.5));
                    label = 'FFTÂäüÁéáË∞±ÂØÜÂ∫¶';
                    color = '#ffd700';
                    yAxisConfig = { min: 0, max: 1 };
                    break;
            }

            const gradient = ctx.createLinearGradient(0, 0, 0, 300);
            gradient.addColorStop(0, color + '40');
            gradient.addColorStop(1, color + '08');

            waveformChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map((_, i) => i),
                    datasets: [{
                        label: label,
                        data: data,
                        borderColor: color,
                        backgroundColor: gradient,
                        borderWidth: 2,
                        fill: true,
                        tension: 0.1,
                        pointRadius: 0,
                        pointHoverRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#ffffff',
                                font: { family: 'Inter', size: 14 }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: '#ffffff',
                                font: { family: 'Inter' }
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            title: {
                                display: true,
                                text: 'Êó∂Èó¥ / ÈááÊ†∑ÁÇπ',
                                color: '#ffffff'
                            }
                        },
                        y: {
                            ticks: {
                                color: '#ffffff',
                                font: { family: 'Inter' }
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            title: {
                                display: true,
                                text: label,
                                color: '#ffffff'
                            },
                            ...yAxisConfig
                        }
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeInOutQuart'
                    }
                }
            });
        }

        // AI Chat Functions
        function updateChatRecords() {
            const container = document.getElementById('chatRecordsList');

            if (healthData.length === 0) {
                container.innerHTML = '<div class="record-item-chat" style="text-align: center; color: var(--text-secondary);">ÊöÇÊó†ËÆ∞ÂΩïÂèØ‰æõÂàÜÊûê</div>';
                return;
            }

            container.innerHTML = healthData.slice(0, 10).map((record, index) => {
                const date = new Date(record.createdAt || record.timestamp);
                return `
                    <div class="record-item-chat" onclick="selectRecordForChat('${record.sessionId}')">
                        <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 8px;">
                            <div style="font-weight: 600; color: var(--primary-cyan);">‰ºöËØù ${String(index + 1).padStart(2, '0')}</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">${date.toLocaleDateString('zh-CN')}</div>
                        </div>
                        <div style="font-size: 14px; color: var(--text-primary);">
                            ÂøÉÁéá: ${record.heartRate ? record.heartRate.toFixed(1) : 'N/A'} BPM
                            ${record.spo2Result ? ` ‚Ä¢ Ë°ÄÊ∞ß: ${record.spo2Result.spo2.toFixed(1)}%` : ''}
                        </div>
                        <div style="font-size: 12px; color: var(--text-secondary); margin-top: 5px;">
                            ÁΩÆ‰ø°Â∫¶: ${record.confidence ? (record.confidence * 100).toFixed(0) : 'N/A'}%
                        </div>
                    </div>
                `;
            }).join('');
        }

        function selectRecordForChat(sessionId) {
            // Remove previous selection
            document.querySelectorAll('.record-item-chat').forEach(item => {
                item.classList.remove('selected');
            });

            // Add selection to clicked item
            event.target.closest('.record-item-chat').classList.add('selected');

            const record = healthData.find(item => item.sessionId === sessionId);
            if (record) {
                selectedRecord = record;

                // Add a message about the selected record
                const recordSummary = `Â∑≤ÈÄâÊã©ËÆ∞ÂΩïËøõË°åÂàÜÊûêÔºö\n‚Ä¢ ÊµãÈáèÊó∂Èó¥: ${new Date(record.createdAt || record.timestamp).toLocaleString('zh-CN')}\n‚Ä¢ ÂøÉÁéá: ${record.heartRate ? record.heartRate.toFixed(1) : 'N/A'} BPM\n‚Ä¢ Ë°ÄÊ∞ß: ${record.spo2Result ? record.spo2Result.spo2.toFixed(1) + '%' : 'N/A'}\n‚Ä¢ ÁΩÆ‰ø°Â∫¶: ${record.confidence ? (record.confidence * 100).toFixed(0) + '%' : 'N/A'}`;

                addChatMessage('ai', `üìä ${recordSummary}\n\nÊàëÂ∑≤ÁªèÂàÜÊûê‰∫ÜËøôÊù°ËÆ∞ÂΩï„ÄÇÊÇ®ÊÉ≥‰∫ÜËß£‰ªÄ‰πàÁâπÂÆöÊñπÈù¢Âë¢ÔºüÊØîÂ¶ÇÔºö\n‚Ä¢ ÂøÉÁéáÊòØÂê¶Ê≠£Â∏∏Ôºü\n‚Ä¢ HRVÊï∞ÊçÆËß£ËØª\n‚Ä¢ ÂéãÂäõÁä∂ÊÄÅËØÑ‰º∞\n‚Ä¢ ÂÅ•Â∫∑Âª∫ËÆÆ`);
            }
        }

        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();

            if (!message) return;

            // Add user message
            addChatMessage('user', message);
            input.value = '';
            input.style.height = 'auto';

            // Show typing indicator
            const typingId = addChatMessage('ai', 'Ê≠£Âú®ÊÄùËÄÉ...');

            try {
                // Prepare context for AI
                let context = `Áî®Êà∑ÈóÆÈ¢ò: ${message}\n\n`;

                if (selectedRecord) {
                    context += `ÂΩìÂâçÂàÜÊûêÁöÑÂÅ•Â∫∑ËÆ∞ÂΩïÔºö\n`;
                    context += `- ÊµãÈáèÊó∂Èó¥: ${new Date(selectedRecord.createdAt || selectedRecord.timestamp).toLocaleString('zh-CN')}\n`;
                    context += `- ÂøÉÁéá: ${selectedRecord.heartRate ? selectedRecord.heartRate.toFixed(1) + ' BPM' : 'Êó†Êï∞ÊçÆ'}\n`;
                    context += `- Ë°ÄÊ∞ßÈ•±ÂíåÂ∫¶: ${selectedRecord.spo2Result ? selectedRecord.spo2Result.spo2.toFixed(1) + '%' : 'Êó†Êï∞ÊçÆ'}\n`;
                    context += `- ÁΩÆ‰ø°Â∫¶: ${selectedRecord.confidence ? (selectedRecord.confidence * 100).toFixed(0) + '%' : 'Êó†Êï∞ÊçÆ'}\n`;

                    if (selectedRecord.hrvResult) {
                        context += `- HRVÊåáÊ†á:\n`;
                        context += `  - RMSSD: ${selectedRecord.hrvResult.rmssd.toFixed(1)} ms\n`;
                        context += `  - SDNN: ${selectedRecord.hrvResult.sdnn.toFixed(1)} ms\n`;
                        context += `  - ÂéãÂäõÊåáÊï∞: ${selectedRecord.hrvResult.stressIndex.toFixed(2)}\n`;
                    }
                }

                context += `\nÁî®Êà∑ÂéÜÂè≤ËÆ∞ÂΩïÊ¶ÇÂÜµÔºö\n`;
                context += `- ÊÄªËÆ∞ÂΩïÊï∞: ${healthData.length}\n`;
                if (healthData.length > 0) {
                    const avgHR = healthData.reduce((sum, item) => sum + (item.heartRate || 0), 0) / healthData.length;
                    context += `- Âπ≥ÂùáÂøÉÁéá: ${avgHR.toFixed(1)} BPM\n`;
                    const avgConf = healthData.reduce((sum, item) => sum + (item.confidence || 0), 0) / healthData.length;
                    context += `- Âπ≥ÂùáÁΩÆ‰ø°Â∫¶: ${(avgConf * 100).toFixed(0)}%\n`;
                }

                const response = await fetch(`${DEEPSEEK_BASE_URL}v1/chat/completions`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${DEEPSEEK_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'deepseek-chat',
                        messages: [
                            {
                                role: 'system',
                                content: '‰Ω†ÊòØRayVitaÁöÑ‰∏ì‰∏öÂÅ•Â∫∑AIÈ°æÈóÆÔºå‰∏ìÈó®ÂàÜÊûêrPPGÂøÉÁéáÊ£ÄÊµãÊï∞ÊçÆ„ÄÇËØ∑Áî®‰∏≠ÊñáÂõûÁ≠îÔºåÊèê‰æõ‰∏ì‰∏ö„ÄÅÂáÜÁ°Æ„ÄÅÊòìÁêÜËß£ÁöÑÂÅ•Â∫∑Âª∫ËÆÆ„ÄÇÈáçÁÇπÂÖ≥Ê≥®ÂøÉÁéá„ÄÅË°ÄÊ∞ß„ÄÅHRVÁ≠âÊåáÊ†áÁöÑËß£ËØªÂíåÂÅ•Â∫∑Âª∫ËÆÆ„ÄÇ‰øùÊåÅÂõûÁ≠îÁÆÄÊ¥ÅÊòé‰∫ÜÔºåÈÄÇÂêàÊôÆÈÄöÁî®Êà∑ÁêÜËß£„ÄÇ'
                            },
                            {
                                role: 'user',
                                content: context
                            }
                        ],
                        stream: false,
                        temperature: 0.7,
                        max_tokens: 1000
                    })
                });

                // Remove typing indicator
                removeChatMessage(typingId);

                if (response.ok) {
                    const data = await response.json();
                    const aiResponse = data.choices[0].message.content;
                    addChatMessage('ai', aiResponse);
                } else {
                    throw new Error(`AIËØ∑Ê±ÇÂ§±Ë¥•: ${response.status}`);
                }

            } catch (error) {
                console.error('AI Chat error:', error);
                removeChatMessage(typingId);
                addChatMessage('ai', 'Êä±Ê≠âÔºåAIÊúçÂä°ÊöÇÊó∂‰∏çÂèØÁî®„ÄÇËØ∑Á®çÂêéÈáçËØï„ÄÇÊÇ®ÂèØ‰ª•Êü•Áúã‰ª™Ë°®Êùø‰∏≠ÁöÑÂÅ•Â∫∑ÊåáÊ†áÊàñËÆ∞ÂΩïËØ¶ÊÉÖÈ°µÈù¢Ëé∑ÂèñÂàÜÊûê‰ø°ÊÅØ„ÄÇ');
            }
        }

        function addChatMessage(sender, content) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageId = 'msg-' + Date.now();

            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            messageDiv.id = messageId;
            messageDiv.innerHTML = formatChatMessage(content);

            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            return messageId;
        }

        function removeChatMessage(messageId) {
            const message = document.getElementById(messageId);
            if (message) {
                message.remove();
            }
        }

        function formatChatMessage(content) {
            return content
                .replace(/\n/g, '<br>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/‚Ä¢/g, '‚Ä¢');
        }

        // AI Analysis Functions
        async function performAIAnalysis() {
            if (!currentUser || healthData.length === 0) {
                showMessage('ÊöÇÊó†ÂÅ•Â∫∑Êï∞ÊçÆËøõË°åAIÂàÜÊûê„ÄÇËØ∑Á°Æ‰øùÊÇ®ÊúârPPGÊµãÈáèËÆ∞ÂΩï„ÄÇ', 'error');
                return;
            }

            const container = document.getElementById('aiAnalysisContent');
            container.innerHTML = `
                <div style="border: 2px solid var(--primary-purple); background: rgba(128, 0, 255, 0.05); padding: 40px; border-radius: 20px; text-align: center;">
                    <div style="font-size: 48px; margin-bottom: 20px;">üß†</div>
                    <h4 style="color: var(--primary-purple); margin-bottom: 15px; font-family: 'Orbitron', monospace;">DeepSeekÁ•ûÁªèÂàÜÊûê‰∏≠</h4>
                    <div class="loading">
                        <div class="spinner"></div>
                        <div>AIÊ≠£Âú®ÂàÜÊûêÊÇ®ÁöÑÂÅ•Â∫∑Ê®°Âºè...</div>
                    </div>
                </div>
            `;

            try {
                // Prepare comprehensive health data summary for AI analysis
                const latestData = healthData.slice(0, 10);
                const summary = {
                    userProfile: {
                        userId: currentUser.user_id,
                        totalSessions: healthData.length,
                        analysisDate: new Date().toISOString()
                    },
                    recentMeasurements: latestData.map(item => ({
                        timestamp: item.createdAt || item.timestamp,
                        heartRate: item.heartRate,
                        spo2: item.spo2Result?.spo2,
                        hrvMetrics: item.hrvResult ? {
                            rmssd: item.hrvResult.rmssd,
                            sdnn: item.hrvResult.sdnn,
                            pnn50: item.hrvResult.pnn50,
                            stressIndex: item.hrvResult.stressIndex
                        } : null,
                        confidence: item.confidence,
                        signalQuality: item.signalQuality
                    })),
                    statisticalSummary: {
                        heartRate: {
                            average: healthData.reduce((sum, item) => sum + (item.heartRate || 0), 0) / healthData.length,
                            min: Math.min(...healthData.map(item => item.heartRate || 0)),
                            max: Math.max(...healthData.map(item => item.heartRate || 0))
                        },
                        spo2: healthData.filter(item => item.spo2Result).length > 0 ? {
                            average: healthData.filter(item => item.spo2Result).reduce((sum, item) => sum + item.spo2Result.spo2, 0) / healthData.filter(item => item.spo2Result).length,
                            min: Math.min(...healthData.filter(item => item.spo2Result).map(item => item.spo2Result.spo2)),
                            max: Math.max(...healthData.filter(item => item.spo2Result).map(item => item.spo2Result.spo2))
                        } : null,
                        hrv: healthData.filter(item => item.hrvResult).length > 0 ? {
                            averageRMSSD: healthData.filter(item => item.hrvResult).reduce((sum, item) => sum + item.hrvResult.rmssd, 0) / healthData.filter(item => item.hrvResult).length,
                            averageStress: healthData.filter(item => item.hrvResult).reduce((sum, item) => sum + item.hrvResult.stressIndex, 0) / healthData.filter(item => item.hrvResult).length
                        } : null
                    }
                };

                const prompt = `‰Ωú‰∏∫‰∏ì‰∏öÁöÑÂÅ•Â∫∑ÂàÜÊûêAIÔºåËØ∑ÂàÜÊûê‰ª•‰∏ãÂÆåÊï¥ÁöÑÁîüÁâ©ÊµãÈáèÊï∞ÊçÆÈõÜÔºö

${JSON.stringify(summary, null, 2)}

ËØ∑Êèê‰æõËØ¶ÁªÜÁöÑÂÅ•Â∫∑ÂàÜÊûêÔºåÂåÖÊã¨Ôºö

üîç **Êï¥‰ΩìËØÑ‰º∞**
- ÂøÉË°ÄÁÆ°ÂÅ•Â∫∑Áä∂ÊÄÅÊÄªËßà
- ËØÜÂà´ÁöÑÂÖ≥ÈîÆË∂ãÂäøÂíåÊ®°Âºè
- Êï∞ÊçÆË¥®ÈáèÂíåÂèØÈù†ÊÄßËØÑ‰º∞

‚ö†Ô∏è **ÂÅ•Â∫∑Ê¥ûÂØü**
- ÂøÉÁéáÂèòÂºÇÊÄßÂàÜÊûê
- ÂéãÂäõÊ∞¥Âπ≥ÊåáÊ†á
- Ë°ÄÊ∞ßÈ•±ÂíåÂ∫¶Ê®°Âºè
- ‰ªª‰ΩïÈúÄË¶ÅÂÖ≥Ê≥®ÁöÑË∂ãÂäøÊàñÂºÇÂ∏∏

üí° **‰∏™ÊÄßÂåñÂª∫ËÆÆ**
- ÁîüÊ¥ªÊñπÂºèÊîπÂñÑÂª∫ËÆÆ
- ÁõëÊµãÈ¢ëÁéáÂª∫ËÆÆ
- ÈúÄË¶ÅÂåªÁñóÂÖ≥Ê≥®ÁöÑÈ¢ÜÂüüÔºàÂ¶ÇÊúâÔºâ
- ÂÅ•Â∫∑‰ºòÂåñÁ≠ñÁï•

üìä **ÊäÄÊúØÂàÜÊûê**
- rPPG‰ø°Âè∑Ë¥®ÈáèËØÑ‰º∞
- ÊµãÈáèÂáÜÁ°ÆÊÄßËØÑ‰º∞
- Êï∞ÊçÆÊî∂ÈõÜÊîπËøõÂª∫ËÆÆ

üéØ **Ë°åÂä®ËÆ°Âàí**
- Á´ãÂç≥ÊîπÂñÑÂÅ•Â∫∑ÁöÑÊ≠•È™§
- ÈïøÊúüÁõëÊµãÁõÆÊ†á
- ‰ΩïÊó∂Âí®ËØ¢ÂåªÁñó‰∏ì‰∏ö‰∫∫Â£´

ËØ∑Áî®‰∏≠ÊñáÊ†ºÂºèÂåñÂõûÁ≠îÔºåÊèê‰æõÊ∏ÖÊô∞ÁöÑÁ´†ËäÇÂíåÂèØÊìç‰ΩúÁöÑÊ¥ûÂØü„ÄÇ‰∏ìÊ≥®‰∫é‰ø°ÊÅØ‰∏∞ÂØå„ÄÅÊîØÊåÅÊÄßÂíåÁßëÂ≠¶ÂáÜÁ°ÆÔºåÂêåÊó∂‰øùÊåÅÁî®Êà∑Êòì‰∫éÁêÜËß£„ÄÇ`;

                const response = await fetch(`${DEEPSEEK_BASE_URL}v1/chat/completions`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${DEEPSEEK_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'deepseek-chat',
                        messages: [
                            {
                                role: 'system',
                                content: '‰Ω†ÊòØ‰∏ìÈó®‰ªé‰∫ãÂøÉË°ÄÁÆ°ÁõëÊµã„ÄÅrPPGÊäÄÊúØÂíåÁîüÁâ©ÊµãÈáèÊï∞ÊçÆËß£ËØªÁöÑ‰∏ì‰∏öAIÂÅ•Â∫∑ÂàÜÊûêÂ∏à„ÄÇÊèê‰æõÂÖ®Èù¢„ÄÅÂáÜÁ°ÆÂíåÂèØÊìç‰ΩúÁöÑÂÅ•Â∫∑Ê¥ûÂØü„ÄÇÁî®‰∏≠ÊñáÂõûÁ≠î„ÄÇ'
                            },
                            {
                                role: 'user',
                                content: prompt
                            }
                        ],
                        stream: false,
                        temperature: 0.7,
                        max_tokens: 2000
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    const analysis = data.choices[0].message.content;

                    // Format and display the AI response
                    const formattedAnalysis = formatAIAnalysis(analysis);

                    container.innerHTML = `
                        <div style="border: 2px solid var(--primary-purple); background: rgba(128, 0, 255, 0.05); padding: 40px; border-radius: 20px;">
                            <div style="text-align: center; margin-bottom: 30px;">
                                <div style="font-size: 48px; margin-bottom: 15px;">üß†</div>
                                <h4 style="color: var(--primary-purple); margin-bottom: 10px; font-family: 'Orbitron', monospace;">DeepSeekÁ•ûÁªèÂàÜÊûêÂÆåÊàê</h4>
                                <div style="color: var(--text-secondary);">Âü∫‰∫é ${healthData.length} È°πÊµãÈáèËÆ∞ÂΩïÁöÑÂàÜÊûê</div>
                            </div>
                            <div style="line-height: 1.8; color: var(--text-primary);">
                                ${formattedAnalysis}
                            </div>
                        </div>
                    `;
                } else {
                    throw new Error(`AIÂàÜÊûêÂ§±Ë¥•: ${response.status}`);
                }
            } catch (error) {
                console.error('AI analysis error:', error);
                container.innerHTML = `
                    <div style="border: 2px dashed rgba(255, 0, 128, 0.3); text-align: center; padding: 40px; border-radius: 20px; background: rgba(255, 0, 128, 0.02);">
                        <div style="font-size: 48px; margin-bottom: 20px;">‚ùå</div>
                        <h4 style="color: var(--accent-pink); margin-bottom: 15px; font-family: 'Orbitron', monospace;">ÂàÜÊûêÊöÇÊó∂‰∏çÂèØÁî®</h4>
                        <p style="color: var(--text-secondary); margin-bottom: 20px;">AIÊúçÂä°ÊöÇÊó∂‰∏çÂèØÁî®„ÄÇËøôÂèØËÉΩÊòØÁî±‰∫éÁΩëÁªúËøûÊé•ÊàñÊúçÂä°ÈôêÂà∂ÈÄ†ÊàêÁöÑ„ÄÇËØ∑Á®çÂêéÈáçËØï„ÄÇ</p>
                        <div style="background: rgba(0, 255, 255, 0.05); padding: 20px; border-radius: 10px; border-left: 3px solid var(--primary-cyan);">
                            <strong>Êõø‰ª£ÊñπÊ°àÔºö</strong> ÊÇ®‰ªçÁÑ∂ÂèØ‰ª•Âú®‰ª™Ë°®ÊùøÂíåËÆ∞ÂΩïÈÉ®ÂàÜÊü•ÁúãÊÇ®ÁöÑÂÅ•Â∫∑ÊåáÊ†áÔºå‰ª•ÊâãÂä®ÂàÜÊûêÊÇ®ÁöÑrPPGÊµãÈáèÁªìÊûú„ÄÇ
                        </div>
                    </div>
                `;
            }
        }

        function formatAIAnalysis(analysis) {
            // Convert markdown-style formatting to HTML
            let formatted = analysis
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/#{1,6}\s*(.*?)$/gm, '<h4 style="color: var(--primary-cyan); margin: 25px 0 15px 0; font-family: \'Orbitron\', monospace; font-size: 18px;">$1</h4>')
                .replace(/^- (.*?)$/gm, '<div style="margin: 10px 0; padding: 15px; background: rgba(0, 255, 255, 0.05); border-radius: 10px; border-left: 3px solid var(--primary-cyan);">‚Ä¢ $1</div>')
                .replace(/(\d+\.)\s*(.*?)$/gm, '<div style="margin: 10px 0; padding: 15px; background: rgba(0, 255, 255, 0.05); border-radius: 10px;"><strong>$1</strong> $2</div>');

            // Add special formatting for sections
            formatted = formatted
                .replace(/üîç\s*\*\*Êï¥‰ΩìËØÑ‰º∞\*\*/g, '<h4 style="color: var(--primary-cyan); margin: 25px 0 15px 0; font-family: \'Orbitron\', monospace;">üîç Êï¥‰ΩìËØÑ‰º∞</h4>')
                .replace(/‚ö†Ô∏è\s*\*\*ÂÅ•Â∫∑Ê¥ûÂØü\*\*/g, '<h4 style="color: var(--accent-orange); margin: 25px 0 15px 0; font-family: \'Orbitron\', monospace;">‚ö†Ô∏è ÂÅ•Â∫∑Ê¥ûÂØü</h4>')
                .replace(/üí°\s*\*\*‰∏™ÊÄßÂåñÂª∫ËÆÆ\*\*/g, '<h4 style="color: var(--accent-green); margin: 25px 0 15px 0; font-family: \'Orbitron\', monospace;">üí° ‰∏™ÊÄßÂåñÂª∫ËÆÆ</h4>')
                .replace(/üìä\s*\*\*ÊäÄÊúØÂàÜÊûê\*\*/g, '<h4 style="color: var(--primary-blue); margin: 25px 0 15px 0; font-family: \'Orbitron\', monospace;">üìä ÊäÄÊúØÂàÜÊûê</h4>')
                .replace(/üéØ\s*\*\*Ë°åÂä®ËÆ°Âàí\*\*/g, '<h4 style="color: var(--accent-pink); margin: 25px 0 15px 0; font-family: \'Orbitron\', monospace;">üéØ Ë°åÂä®ËÆ°Âàí</h4>');

            return formatted;
        }

        // Social Functions
        async function loadSocialData() {
            if (!currentUser) return;

            try {
                // Load social feed
                const feedResponse = await fetch(`${RAYVITA_BASE_URL}post/feed?user_id=${currentUser.user_id}&scope=all`);
                if (feedResponse.ok) {
                    socialPosts = await feedResponse.json();
                } else {
                    // Generate sample social data for demo
                    generateSampleSocialData();
                }

                renderSocialFeed(socialPosts);

                // Load friends network
                const friendsResponse = await fetch(`${RAYVITA_BASE_URL}friend/list?user_id=${currentUser.user_id}`);
                if (friendsResponse.ok) {
                    const friendsData = await friendsResponse.json();
                    renderFriendsNetwork(friendsData);
                } else {
                    renderFriendsNetwork([]);
                }

            } catch (error) {
                console.error('Error loading social data:', error);
                generateSampleSocialData();
                renderSocialFeed(socialPosts);
                renderFriendsNetwork([]);
            }
        }

        function generateSampleSocialData() {
            socialPosts = [
                {
                    post_id: 1,
                    user_id: 101,
                    post_dt: new Date(Date.now() - 3600000).toISOString(),
                    text_content: "‰ªäÂ§©ÁöÑÂøÉÁéáÊ£ÄÊµãÁªìÊûúÂæà‰∏çÈîôÔºÅÈùôÊÅØÂøÉÁéá68 BPMÔºåÊÑüËßâË∫´‰ΩìÁä∂ÊÄÅÂæàÂ•Ω üí™ #ÂÅ•Â∫∑ÁîüÊ¥ª #rPPGÊäÄÊúØ",
                    like_count: 12,
                    comment_count: 3,
                    user_liked: false
                },
                {
                    post_id: 2,
                    user_id: 102,
                    post_dt: new Date(Date.now() - 7200000).toISOString(),
                    text_content: "ÂàöÂàöÂÆåÊàê‰∫Ü10ÂàÜÈíüÁöÑÂÜ•ÊÉ≥ÔºåHRVÊåáÊ†áÊòéÊòæÊîπÂñÑÔºÅÂéãÂäõÁÆ°ÁêÜÁúüÁöÑÂæàÈáçË¶Å üßò‚Äç‚ôÄÔ∏è",
                    like_count: 8,
                    comment_count: 2,
                    user_liked: true
                },
                {
                    post_id: 3,
                    user_id: 103,
                    post_dt: new Date(Date.now() - 14400000).toISOString(),
                    text_content: "‰ΩøÁî®RayVitaÂ∑≤Áªè‰∏Ä‰∏™Êúà‰∫ÜÔºåÂøÉÁéáÊï∞ÊçÆÊòæÁ§∫ÊàëÁöÑÂøÉË°ÄÁÆ°ÂÅ•Â∫∑Âú®ÈÄêÊ≠•ÊîπÂñÑÔºÅÊÑüË∞¢Ëøô‰∏™Á•ûÂ•áÁöÑÂ∫îÁî® ‚ù§Ô∏è",
                    like_count: 25,
                    comment_count: 8,
                    user_liked: false
                }
            ];
        }

        function renderSocialFeed(posts) {
            const container = document.getElementById('socialFeed');

            if (posts.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; color: var(--text-secondary); padding: 60px; background: rgba(0, 255, 255, 0.02); border-radius: 20px; border: 1px dashed rgba(0, 255, 255, 0.2);">
                        <div style="font-size: 64px; margin-bottom: 20px;">üí¨</div>
                        <div style="font-size: 20px; font-weight: 600; margin-bottom: 15px;">ÊöÇÊó†Âä®ÊÄÅ</div>
                        <div style="font-size: 16px;">Êàê‰∏∫Á¨¨‰∏Ä‰∏™ÂàÜ‰∫´ÂÅ•Â∫∑ÂøÉÂæóÁöÑ‰∫∫ÔºÅ</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = posts.map(post => {
                const date = new Date(post.post_dt);
                const timeAgo = getTimeAgo(date);
                const userInitial = `Áî®Êà∑${post.user_id}`.charAt(0).toUpperCase();

                return `
                    <div class="post-item">
                        <div class="post-header">
                            <div class="post-avatar">${userInitial}</div>
                            <div class="post-meta">
                                <div class="post-author">Áî®Êà∑${post.user_id}</div>
                                <div class="post-time">${timeAgo}</div>
                            </div>
                        </div>
                        <div class="post-content">${post.text_content || 'ÂàÜ‰∫´‰∫Ü‰∏ÄÊù°ÂÅ•Â∫∑Âä®ÊÄÅ'}</div>
                        <div class="post-actions">
                            <button class="action-btn btn-like ${post.user_liked ? 'liked' : ''}" onclick="toggleLike(${post.post_id})">
                                üíñ ${post.like_count || 0}
                            </button>
                            <button class="action-btn btn-comment">
                                üí¨ ${post.comment_count || 0}
                            </button>
                            <button class="action-btn btn-share">
                                üîÑ ÂàÜ‰∫´
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderFriendsNetwork(friends) {
            const container = document.getElementById('friendsNetwork');

            if (friends.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; color: var(--text-secondary); padding: 30px;">
                        <div style="font-size: 32px; margin-bottom: 10px;">üë•</div>
                        <div style="font-size: 14px;">ÊöÇÊó†ÂÅ•Â∫∑ÁΩëÁªúËøûÊé•</div>
                        <div style="font-size: 12px; margin-top: 5px;">ÂºÄÂßãÂª∫Á´ãÊÇ®ÁöÑÂÅ•Â∫∑Á§æÂå∫ÔºÅ</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = friends.slice(0, 5).map(friend => `
                <div style="display: flex; align-items: center; gap: 10px; padding: 10px 0; border-bottom: 1px solid rgba(0, 255, 255, 0.1);">
                    <div style="width: 32px; height: 32px; background: linear-gradient(45deg, var(--accent-green), var(--primary-blue)); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #fff; font-weight: 600; font-size: 14px;">
                        ${(friend.nickname || `Áî®Êà∑${friend.user_id}`).charAt(0).toUpperCase()}
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; font-size: 14px;">${friend.nickname || `Áî®Êà∑${friend.user_id}`}</div>
                        <div style="font-size: 12px; color: var(--accent-green);">Âú®Á∫ø</div>
                    </div>
                </div>
            `).join('');
        }

        function updateSocialStats() {
            // Update social statistics
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            const todayMeasurements = healthData.filter(item => {
                const itemDate = new Date(item.createdAt || item.timestamp);
                return itemDate >= today;
            }).length;

            document.getElementById('todayMeasurements').textContent = todayMeasurements;

            if (healthData.length > 0) {
                const weeklyData = healthData.filter(item => {
                    const itemDate = new Date(item.createdAt || item.timestamp);
                    const weekAgo = new Date(Date.now() - 7 * 24 * 3600 * 1000);
                    return itemDate >= weekAgo;
                });

                if (weeklyData.length > 0) {
                    const avgHR = weeklyData.reduce((sum, item) => sum + (item.heartRate || 0), 0) / weeklyData.length;
                    document.getElementById('weeklyAvgHR').textContent = avgHR.toFixed(1);
                }

                // Calculate health score
                const latest = healthData[0];
                let healthScore = 85; // Base score

                if (latest.heartRate && latest.heartRate >= 60 && latest.heartRate <= 100) {
                    healthScore += 5;
                }
                if (latest.spo2Result && latest.spo2Result.spo2 >= 98) {
                    healthScore += 5;
                }
                if (latest.hrvResult && latest.hrvResult.stressIndex < 0.5) {
                    healthScore += 5;
                }

                document.getElementById('healthScore').textContent = Math.min(healthScore, 100);
            }
        }

        async function createPost() {
            const textContent = document.getElementById('postText').value.trim();
            if (!textContent || !currentUser) return;

            try {
                const response = await fetch(`${RAYVITA_BASE_URL}post/create`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: currentUser.user_id,
                        text_content: textContent,
                        post_type: 'health_update'
                    })
                });

                if (response.ok) {
                    document.getElementById('postText').value = '';
                    showMessage('ÂÅ•Â∫∑Âä®ÊÄÅÂèëÂ∏ÉÊàêÂäüÔºÅüéâ', 'success');
                    loadSocialData(); // Refresh the feed
                } else {
                    const data = await response.json();
                    showMessage(data.msg || 'ÂèëÂ∏ÉÂ§±Ë¥•', 'error');
                }
            } catch (error) {
                console.error('Error creating post:', error);
                // Add post locally for demo
                const newPost = {
                    post_id: Date.now(),
                    user_id: currentUser.user_id,
                    post_dt: new Date().toISOString(),
                    text_content: textContent,
                    like_count: 0,
                    comment_count: 0,
                    user_liked: false
                };
                socialPosts.unshift(newPost);
                renderSocialFeed(socialPosts);
                document.getElementById('postText').value = '';
                showMessage('ÂÅ•Â∫∑Âä®ÊÄÅÂèëÂ∏ÉÊàêÂäüÔºÅüéâ', 'success');
            }
        }

        async function toggleLike(postId) {
            if (!currentUser) return;

            try {
                const response = await fetch(`${RAYVITA_BASE_URL}post/${postId}/like`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: currentUser.user_id
                    })
                });

                if (response.ok) {
                    loadSocialData(); // Refresh to update like counts
                } else {
                    // Handle locally for demo
                    const post = socialPosts.find(p => p.post_id === postId);
                    if (post) {
                        if (post.user_liked) {
                            post.like_count--;
                            post.user_liked = false;
                        } else {
                            post.like_count++;
                            post.user_liked = true;
                        }
                        renderSocialFeed(socialPosts);
                    }
                }
            } catch (error) {
                console.error('Error toggling like:', error);
                // Handle locally for demo
                const post = socialPosts.find(p => p.post_id === postId);
                if (post) {
                    if (post.user_liked) {
                        post.like_count--;
                        post.user_liked = false;
                    } else {
                        post.like_count++;
                        post.user_liked = true;
                    }
                    renderSocialFeed(socialPosts);
                }
            }
        }

        // Download Functions
        function downloadAPK() {
            showMessage('Ê≠£Âú®ÂáÜÂ§á‰∏ãËΩΩRayVita.apk...', 'success');

            // Simulate APK download
            setTimeout(() => {
                const link = document.createElement('a');
                link.href = '#'; // In real implementation, this would be the actual APK URL
                link.download = 'RayVita.apk';

                showMessage('APKÊñá‰ª∂Â∞ÜÂæàÂø´ÂèëÂ∏ÉÔºÅüì± ËØ∑ÂÖ≥Ê≥®Êàë‰ª¨ÁöÑÊõ¥Êñ∞ÈÄöÁü•„ÄÇ', 'success');

                // In a real implementation, you would trigger the actual download
                // document.body.appendChild(link);
                // link.click();
                // document.body.removeChild(link);
            }, 1500);
        }

        // Utility Functions
        function getTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMins / 60);
            const diffDays = Math.floor(diffHours / 24);

            if (diffDays > 0) return `${diffDays}Â§©Ââç`;
            if (diffHours > 0) return `${diffHours}Â∞èÊó∂Ââç`;
            if (diffMins > 0) return `${diffMins}ÂàÜÈíüÂâç`;
            return 'ÂàöÂàö';
        }

        function showMessage(message, type) {
            // Create floating notification
            const notification = document.createElement('div');
            notification.className = `${type}-message`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 10000;
                padding: 15px 25px;
                border-radius: 10px;
                font-weight: 600;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                animation: slideIn 0.3s ease-out;
                max-width: 400px;
            `;

            const icon = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è';
            notification.innerHTML = `${icon} ${message}`;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-in forwards';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 4000);

            // Also update auth message container if exists
            const container = document.getElementById('authMessage');
            if (container) {
                container.innerHTML = `<div class="${type}-message">${icon} ${message}</div>`;
                setTimeout(() => {
                    container.innerHTML = '';
                }, 5000);
            }
        }

        function clearMessages() {
            const container = document.getElementById('authMessage');
            if (container) {
                container.innerHTML = '';
            }
        }

        // Add CSS animations for notifications
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Auto-refresh health data every 5 minutes
        setInterval(() => {
            if (currentUser && isLoggedIn) {
                loadHealthData();
            }
        }, 5 * 60 * 1000);

        // Auto-refresh social data every 2 minutes
        setInterval(() => {
            if (currentUser && isLoggedIn) {
                loadSocialData();
            }
        }, 2 * 60 * 1000);

        // Click outside to close record viewer
        document.addEventListener('click', function(e) {
            const modal = document.getElementById('recordViewerModal');
            if (e.target === modal) {
                closeRecordViewer();
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Escape to close modals
            if (e.key === 'Escape') {
                closeRecordViewer();
            }
        });
    </script>
</body>
</html>